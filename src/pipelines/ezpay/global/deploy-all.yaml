trigger: none

variables:
- group: helm-chart-svc-principal-config

resources:
  repositories:
  - repository: ezpay-frontend-apps
    type: git
    name: ezpay-frontend-apps
    ref: refs/heads/master  

  - repository: ezpay-backend-services
    type: git
    name: ezpay-backend-services
    ref: refs/heads/master 

  pipelines:
  - pipeline: ezpay-merchant-portal-master-build
    source: ezpay-merchant-portal-master-build
    trigger:
      branches:
      - master

  - pipeline: ezpay-payer-portal-master-build
    source: ezpay-payer-portal-master-build
    trigger:
      branches:
      - master

  - pipeline: ezpay-static-assets-master-build
    source: ezpay-static-assets-master-build
    trigger:
      branches:
      - master
    
stages:

## EZPAY API SVC ##
- stage: TST_GQL_API_Svc_Helm_Deploy
  displayName: TST - Ezpay API SVC (GQL) Helm Deploy
  dependsOn: []

  jobs:
  - deployment: Helm_Deploy
    displayName: Helm Deploy
    environment: ezpay-tst

    pool:
      vmImage: 'ubuntu-latest'

    variables:
    - group: ezpay-api-svc-tst
    - template: ../api-svc/helm-variables-tst.yaml

    strategy:
      runOnce:
        deploy:
          steps:
          - template: ../api-svc/helm-deploy-step.yaml
            parameters:
              serviceConnection: 'AzDevOps-Pipeline-Principal-DEV-TST-STG'
              svcPrincipalClientId: $(SVC_PRINCIPAL_CLIENT_ID_SHR)
              svcPrincipalSecret: $(SVC_PRINCIPAL_SECRET_SHR)
              azureTenantId: $(AZURE_TENANT_ID)
              aksName: $(AKS_NAME)
              aksResourceGroup: $(AKS_RESOURCE_GROUP)
              containerRegistryName: $(CONTAINER_REGISTRY_NAME)
              imageRepositoryName: $(IMAGE_REPOSITORY_NAME)
              chartRepositoryName: $(CHART_REPOSITORY_NAME)
              k8sNamespace: $(K8S_NAMESPACE)
              helmReleaseName: $(HELM_RELEASE_NAME)-gql
              chartName: $(CHART_NAME)
              env: $(ENV)
              replicas: $(REPLICAS)
              frontDoorId: $(FRONT_DOOR_ID)
              kongIngressClass: $(KONG_INGRESS_CLASS)
              kongIngressUpstreamHostHeader: $(KONG_INGRESS_UPSTREAM_HEADER)
              resourceLimitsCpu: $(RESOURCE_LIMITS_CPU)
              resourceLimitsMemory: $(RESOURCE_LIMITS_MEMORY)
              resourceRequestsCpu: $(RESOURCE_REQUESTS_CPU)
              resourceRequestsMemory: $(RESOURCE_REQUESTS_MEMORY)
              appInsightsKey: $(APP_INSIGHTS_INSTRUMENTATION_KEY)
              cosmosConnString: $(COSMOSDB_CONN_STRING)
              cosmosDatabase: $(COSMOSDB_EZPAY_DATABASE)
              cosmosContainer: $(COSMOSDB_DATA_PROJECTIONS_CONTAINER)              
              serviceBusConnectionString: $(SB_CONN_STRING)
              sbEventsTopic: $(SB_PLATFORM_EVENTS_TOPIC)
              sbPlatformEventsSubscription: $(SB_PLATFORM_EVENTS_SUBSCRIPTION)
              sbPlatformEventsTopicConnectionString: $(SB_PLATFORM_EVENTS_TOPIC_CONN_STRING)
              b2cClientId: $(B2C_CLIENT_ID)
              b2cDomainHost: $(B2C_DOMAIN_HOST)
              b2cTenantId: $(B2C_TENANT_ID)
              b2cPolicyName: $(B2C_POLICY_NAME)
              subsMgmtGrpcUrl: $(GRPC_URL_SUBS_MGMT)
              subsMgmtServiceId: $(SUBS_MGMT_SERVICE_ID)
              subsMgmtApiKey: $(SUBS_MGMT_API_KEY)  
              wepayGrpcUrl: $(GRPC_URL_WEPAY_INTEGRATION)
              wepayApiVersion: $(WEPAY_API_VERSION)
              wepayAppId: $(WEPAY_APP_ID)
              wepayAppToken: $(WEPAY_APP_TOKEN)
              paymentsFromPhoneNumber: $(PAYMENTS_PLATFORM_FROM_PHONE_NUMBER)
              paymentsFromEmail: $(PAYMENTS_PLATFORM_FROM_EMAIL)
              processPlatformEvents: $(PROCESS_PLATFORM_EVENTS)
              blobStorageUrl: $(BLOB_STORAGE_URL)
              encryptPayerUrlToken: $(ENCRYPT_PAYER_URL_TOKEN)
              encryptionKey: $(ENCRYPTION_KEY)
              ezpayTosVersion: $(EZPAY_TOS_VERSION)
              statementsContainerName: $(STATEMENTS_CONTAINER_NAME)
              invoiceContainerName: $(INVOICE_CONTAINER_NAME)
              invoiceBlobConnectionString: $(INVOICE_BLOB_CONNECTION_STRING)
              urlShortenerUrl: $(LOGIC_APP_URL_SHORTENER_URL)
              payerPortalUrl: $(PAYER_PORTAL_BASE_URL)
              productApisOnly: $(PRODUCT_APIS_ONLY)
              apiKind: GQL             

- stage: TST_GRPC_API_Svc_Helm_Deploy
  displayName: TST - Ezpay API SVC (GRPC) Helm Deploy
  dependsOn: []

  jobs:
  - deployment: Helm_Deploy
    displayName: Helm Deploy
    environment: ezpay-tst

    pool:
      vmImage: 'ubuntu-latest'

    variables:
    - group: ezpay-api-svc-tst
    - template: ../api-svc/helm-variables-tst.yaml

    strategy:
      runOnce:
        deploy:
          steps:
          - template: ../api-svc/helm-deploy-step.yaml
            parameters:
              serviceConnection: 'AzDevOps-Pipeline-Principal-DEV-TST-STG'
              svcPrincipalClientId: $(SVC_PRINCIPAL_CLIENT_ID_SHR)
              svcPrincipalSecret: $(SVC_PRINCIPAL_SECRET_SHR)
              azureTenantId: $(AZURE_TENANT_ID)
              aksName: $(AKS_NAME)
              aksResourceGroup: $(AKS_RESOURCE_GROUP)
              containerRegistryName: $(CONTAINER_REGISTRY_NAME)
              imageRepositoryName: $(IMAGE_REPOSITORY_NAME)
              chartRepositoryName: $(CHART_REPOSITORY_NAME)
              k8sNamespace: $(K8S_NAMESPACE)
              helmReleaseName: $(HELM_RELEASE_NAME)-grpc
              chartName: $(CHART_NAME)
              env: $(ENV)
              replicas: $(REPLICAS)
              frontDoorId: $(FRONT_DOOR_ID)
              kongIngressClass: $(KONG_INGRESS_CLASS)
              kongIngressUpstreamHostHeader: $(KONG_INGRESS_UPSTREAM_HEADER)
              resourceLimitsCpu: $(RESOURCE_LIMITS_CPU)
              resourceLimitsMemory: $(RESOURCE_LIMITS_MEMORY)
              resourceRequestsCpu: $(RESOURCE_REQUESTS_CPU)
              resourceRequestsMemory: $(RESOURCE_REQUESTS_MEMORY)
              appInsightsKey: $(APP_INSIGHTS_INSTRUMENTATION_KEY)
              cosmosConnString: $(COSMOSDB_CONN_STRING)
              cosmosDatabase: $(COSMOSDB_EZPAY_DATABASE)
              cosmosContainer: $(COSMOSDB_DATA_PROJECTIONS_CONTAINER)              
              serviceBusConnectionString: $(SB_CONN_STRING)
              sbEventsTopic: $(SB_PLATFORM_EVENTS_TOPIC)
              sbPlatformEventsSubscription: $(SB_PLATFORM_EVENTS_SUBSCRIPTION)
              sbPlatformEventsTopicConnectionString: $(SB_PLATFORM_EVENTS_TOPIC_CONN_STRING)
              b2cClientId: $(B2C_CLIENT_ID)
              b2cDomainHost: $(B2C_DOMAIN_HOST)
              b2cTenantId: $(B2C_TENANT_ID)
              b2cPolicyName: $(B2C_POLICY_NAME)
              subsMgmtGrpcUrl: $(GRPC_URL_SUBS_MGMT)
              subsMgmtServiceId: $(SUBS_MGMT_SERVICE_ID)
              subsMgmtApiKey: $(SUBS_MGMT_API_KEY)  
              wepayGrpcUrl: $(GRPC_URL_WEPAY_INTEGRATION)
              wepayApiVersion: $(WEPAY_API_VERSION)
              wepayAppId: $(WEPAY_APP_ID)
              wepayAppToken: $(WEPAY_APP_TOKEN)
              paymentsFromPhoneNumber: $(PAYMENTS_PLATFORM_FROM_PHONE_NUMBER)
              paymentsFromEmail: $(PAYMENTS_PLATFORM_FROM_EMAIL)
              processPlatformEvents: $(PROCESS_PLATFORM_EVENTS)
              blobStorageUrl: $(BLOB_STORAGE_URL)
              encryptPayerUrlToken: $(ENCRYPT_PAYER_URL_TOKEN)
              encryptionKey: $(ENCRYPTION_KEY)
              ezpayTosVersion: $(EZPAY_TOS_VERSION)
              statementsContainerName: $(STATEMENTS_CONTAINER_NAME)
              invoiceContainerName: $(INVOICE_CONTAINER_NAME)
              invoiceBlobConnectionString: $(INVOICE_BLOB_CONNECTION_STRING)
              urlShortenerUrl: $(LOGIC_APP_URL_SHORTENER_URL)
              payerPortalUrl: $(PAYER_PORTAL_BASE_URL)
              productApisOnly: $(PRODUCT_APIS_ONLY)
              apiKind: GRPC             

- stage: STG_GQL_API_Svc_Helm_Deploy
  displayName: STG - Ezpay API SVC (GQL) Helm Deploy
  dependsOn: TST_GQL_API_Svc_Helm_Deploy

  jobs:
  - deployment: Helm_Deploy
    displayName: Helm Deploy
    environment: ezpay-stg

    pool:
      vmImage: 'ubuntu-latest'

    variables:
    - group: ezpay-api-svc-stg
    - template: ../api-svc/helm-variables-stg.yaml

    strategy:
      runOnce:
        deploy:
          steps:
          - template: ../api-svc/helm-deploy-step.yaml
            parameters:
              serviceConnection: 'AzDevOps-Pipeline-Principal-DEV-TST-STG'
              svcPrincipalClientId: $(SVC_PRINCIPAL_CLIENT_ID_SHR)
              svcPrincipalSecret: $(SVC_PRINCIPAL_SECRET_SHR)
              azureTenantId: $(AZURE_TENANT_ID)
              aksName: $(AKS_NAME)
              aksResourceGroup: $(AKS_RESOURCE_GROUP)
              containerRegistryName: $(CONTAINER_REGISTRY_NAME)
              imageRepositoryName: $(IMAGE_REPOSITORY_NAME)
              chartRepositoryName: $(CHART_REPOSITORY_NAME)
              k8sNamespace: $(K8S_NAMESPACE)
              helmReleaseName: $(HELM_RELEASE_NAME)-gql
              chartName: $(CHART_NAME)
              env: $(ENV)
              replicas: $(REPLICAS)
              frontDoorId: $(FRONT_DOOR_ID)
              kongIngressClass: $(KONG_INGRESS_CLASS)
              kongIngressUpstreamHostHeader: $(KONG_INGRESS_UPSTREAM_HEADER)
              resourceLimitsCpu: $(RESOURCE_LIMITS_CPU)
              resourceLimitsMemory: $(RESOURCE_LIMITS_MEMORY)
              resourceRequestsCpu: $(RESOURCE_REQUESTS_CPU)
              resourceRequestsMemory: $(RESOURCE_REQUESTS_MEMORY)
              appInsightsKey: $(APP_INSIGHTS_INSTRUMENTATION_KEY)
              cosmosConnString: $(COSMOSDB_CONN_STRING)
              cosmosDatabase: $(COSMOSDB_EZPAY_DATABASE)
              cosmosContainer: $(COSMOSDB_DATA_PROJECTIONS_CONTAINER)              
              serviceBusConnectionString: $(SB_CONN_STRING)
              sbEventsTopic: $(SB_PLATFORM_EVENTS_TOPIC)
              sbPlatformEventsSubscription: $(SB_PLATFORM_EVENTS_SUBSCRIPTION)
              sbPlatformEventsTopicConnectionString: $(SB_PLATFORM_EVENTS_TOPIC_CONN_STRING)
              b2cClientId: $(B2C_CLIENT_ID)
              b2cDomainHost: $(B2C_DOMAIN_HOST)
              b2cTenantId: $(B2C_TENANT_ID)
              b2cPolicyName: $(B2C_POLICY_NAME)
              subsMgmtGrpcUrl: $(GRPC_URL_SUBS_MGMT)
              subsMgmtServiceId: $(SUBS_MGMT_SERVICE_ID)
              subsMgmtApiKey: $(SUBS_MGMT_API_KEY)  
              wepayGrpcUrl: $(GRPC_URL_WEPAY_INTEGRATION)
              wepayApiVersion: $(WEPAY_API_VERSION)
              wepayAppId: $(WEPAY_APP_ID)
              wepayAppToken: $(WEPAY_APP_TOKEN)
              paymentsFromPhoneNumber: $(PAYMENTS_PLATFORM_FROM_PHONE_NUMBER)
              paymentsFromEmail: $(PAYMENTS_PLATFORM_FROM_EMAIL)
              processPlatformEvents: $(PROCESS_PLATFORM_EVENTS)
              blobStorageUrl: $(BLOB_STORAGE_URL)
              encryptPayerUrlToken: $(ENCRYPT_PAYER_URL_TOKEN)
              encryptionKey: $(ENCRYPTION_KEY)
              ezpayTosVersion: $(EZPAY_TOS_VERSION)
              statementsContainerName: $(STATEMENTS_CONTAINER_NAME)
              invoiceContainerName: $(INVOICE_CONTAINER_NAME)
              invoiceBlobConnectionString: $(INVOICE_BLOB_CONNECTION_STRING)
              urlShortenerUrl: $(LOGIC_APP_URL_SHORTENER_URL)
              payerPortalUrl: $(PAYER_PORTAL_BASE_URL)
              productApisOnly: $(PRODUCT_APIS_ONLY)
              apiKind: GQL

- stage: STG_GRPC_API_Svc_Helm_Deploy
  displayName: STG - Ezpay API SVC (GRPC) Helm Deploy
  dependsOn: TST_GRPC_API_Svc_Helm_Deploy

  jobs:
  - deployment: Helm_Deploy
    displayName: Helm Deploy
    environment: ezpay-stg

    pool:
      vmImage: 'ubuntu-latest'

    variables:
    - group: ezpay-api-svc-stg
    - template: ../api-svc/helm-variables-stg.yaml

    strategy:
      runOnce:
        deploy:
          steps:
          - template: ../api-svc/helm-deploy-step.yaml
            parameters:
              serviceConnection: 'AzDevOps-Pipeline-Principal-DEV-TST-STG'
              svcPrincipalClientId: $(SVC_PRINCIPAL_CLIENT_ID_SHR)
              svcPrincipalSecret: $(SVC_PRINCIPAL_SECRET_SHR)
              azureTenantId: $(AZURE_TENANT_ID)
              aksName: $(AKS_NAME)
              aksResourceGroup: $(AKS_RESOURCE_GROUP)
              containerRegistryName: $(CONTAINER_REGISTRY_NAME)
              imageRepositoryName: $(IMAGE_REPOSITORY_NAME)
              chartRepositoryName: $(CHART_REPOSITORY_NAME)
              k8sNamespace: $(K8S_NAMESPACE)
              helmReleaseName: $(HELM_RELEASE_NAME)-grpc
              chartName: $(CHART_NAME)
              env: $(ENV)
              replicas: $(REPLICAS)
              frontDoorId: $(FRONT_DOOR_ID)
              kongIngressClass: $(KONG_INGRESS_CLASS)
              kongIngressUpstreamHostHeader: $(KONG_INGRESS_UPSTREAM_HEADER)
              resourceLimitsCpu: $(RESOURCE_LIMITS_CPU)
              resourceLimitsMemory: $(RESOURCE_LIMITS_MEMORY)
              resourceRequestsCpu: $(RESOURCE_REQUESTS_CPU)
              resourceRequestsMemory: $(RESOURCE_REQUESTS_MEMORY)
              appInsightsKey: $(APP_INSIGHTS_INSTRUMENTATION_KEY)
              cosmosConnString: $(COSMOSDB_CONN_STRING)
              cosmosDatabase: $(COSMOSDB_EZPAY_DATABASE)
              cosmosContainer: $(COSMOSDB_DATA_PROJECTIONS_CONTAINER)              
              serviceBusConnectionString: $(SB_CONN_STRING)
              sbEventsTopic: $(SB_PLATFORM_EVENTS_TOPIC)
              sbPlatformEventsSubscription: $(SB_PLATFORM_EVENTS_SUBSCRIPTION)
              sbPlatformEventsTopicConnectionString: $(SB_PLATFORM_EVENTS_TOPIC_CONN_STRING)
              b2cClientId: $(B2C_CLIENT_ID)
              b2cDomainHost: $(B2C_DOMAIN_HOST)
              b2cTenantId: $(B2C_TENANT_ID)
              b2cPolicyName: $(B2C_POLICY_NAME)
              subsMgmtGrpcUrl: $(GRPC_URL_SUBS_MGMT)
              subsMgmtServiceId: $(SUBS_MGMT_SERVICE_ID)
              subsMgmtApiKey: $(SUBS_MGMT_API_KEY)  
              wepayGrpcUrl: $(GRPC_URL_WEPAY_INTEGRATION)
              wepayApiVersion: $(WEPAY_API_VERSION)
              wepayAppId: $(WEPAY_APP_ID)
              wepayAppToken: $(WEPAY_APP_TOKEN)
              paymentsFromPhoneNumber: $(PAYMENTS_PLATFORM_FROM_PHONE_NUMBER)
              paymentsFromEmail: $(PAYMENTS_PLATFORM_FROM_EMAIL)
              processPlatformEvents: $(PROCESS_PLATFORM_EVENTS)
              blobStorageUrl: $(BLOB_STORAGE_URL)
              encryptPayerUrlToken: $(ENCRYPT_PAYER_URL_TOKEN)
              encryptionKey: $(ENCRYPTION_KEY)
              ezpayTosVersion: $(EZPAY_TOS_VERSION)
              statementsContainerName: $(STATEMENTS_CONTAINER_NAME)
              invoiceContainerName: $(INVOICE_CONTAINER_NAME)
              invoiceBlobConnectionString: $(INVOICE_BLOB_CONNECTION_STRING)
              urlShortenerUrl: $(LOGIC_APP_URL_SHORTENER_URL)
              payerPortalUrl: $(PAYER_PORTAL_BASE_URL)
              productApisOnly: $(PRODUCT_APIS_ONLY)
              apiKind: GRPC   

- stage: PRD_GQL_API_Svc_Helm_Deploy
  displayName: PRD - Ezpay API SVC (GQL) Helm Deploy
  dependsOn: STG_GQL_API_Svc_Helm_Deploy

  jobs:
  - deployment: Helm_Deploy
    displayName: Helm Deploy
    environment: ezpay-prd

    pool:
      vmImage: 'ubuntu-latest'

    variables:
    - group: ezpay-api-svc-prd
    - template: ../api-svc/helm-variables-prd.yaml

    strategy:
      runOnce:
        deploy:
          steps:
          - template: ../api-svc/helm-deploy-step.yaml
            parameters:
              serviceConnection: 'AzDevOps-Pipeline-Principal-PRD'
              svcPrincipalClientId: $(SVC_PRINCIPAL_CLIENT_ID_PRD)
              svcPrincipalSecret: $(SVC_PRINCIPAL_SECRET_PRD)
              azureTenantId: $(AZURE_TENANT_ID)
              aksName: $(AKS_NAME)
              aksResourceGroup: $(AKS_RESOURCE_GROUP)
              containerRegistryName: $(CONTAINER_REGISTRY_NAME)
              imageRepositoryName: $(IMAGE_REPOSITORY_NAME)
              chartRepositoryName: $(CHART_REPOSITORY_NAME)
              k8sNamespace: $(K8S_NAMESPACE)
              helmReleaseName: $(HELM_RELEASE_NAME)-gql
              chartName: $(CHART_NAME)
              env: $(ENV)
              replicas: $(REPLICAS)
              frontDoorId: $(FRONT_DOOR_ID)
              kongIngressClass: $(KONG_INGRESS_CLASS)
              kongIngressUpstreamHostHeader: $(KONG_INGRESS_UPSTREAM_HEADER)
              resourceLimitsCpu: $(RESOURCE_LIMITS_CPU)
              resourceLimitsMemory: $(RESOURCE_LIMITS_MEMORY)
              resourceRequestsCpu: $(RESOURCE_REQUESTS_CPU)
              resourceRequestsMemory: $(RESOURCE_REQUESTS_MEMORY)
              appInsightsKey: $(APP_INSIGHTS_INSTRUMENTATION_KEY)
              cosmosConnString: $(COSMOSDB_CONN_STRING)
              cosmosDatabase: $(COSMOSDB_EZPAY_DATABASE)
              cosmosContainer: $(COSMOSDB_DATA_PROJECTIONS_CONTAINER)              
              serviceBusConnectionString: $(SB_CONN_STRING)
              sbEventsTopic: $(SB_PLATFORM_EVENTS_TOPIC)
              sbPlatformEventsSubscription: $(SB_PLATFORM_EVENTS_SUBSCRIPTION)
              sbPlatformEventsTopicConnectionString: $(SB_PLATFORM_EVENTS_TOPIC_CONN_STRING)
              b2cClientId: $(B2C_CLIENT_ID)
              b2cDomainHost: $(B2C_DOMAIN_HOST)
              b2cTenantId: $(B2C_TENANT_ID)
              b2cPolicyName: $(B2C_POLICY_NAME)
              subsMgmtGrpcUrl: $(GRPC_URL_SUBS_MGMT)
              subsMgmtServiceId: $(SUBS_MGMT_SERVICE_ID)
              subsMgmtApiKey: $(SUBS_MGMT_API_KEY)  
              wepayGrpcUrl: $(GRPC_URL_WEPAY_INTEGRATION)
              wepayApiVersion: $(WEPAY_API_VERSION)
              wepayAppId: $(WEPAY_APP_ID)
              wepayAppToken: $(WEPAY_APP_TOKEN)
              paymentsFromPhoneNumber: $(PAYMENTS_PLATFORM_FROM_PHONE_NUMBER)
              paymentsFromEmail: $(PAYMENTS_PLATFORM_FROM_EMAIL)
              processPlatformEvents: $(PROCESS_PLATFORM_EVENTS)
              blobStorageUrl: $(BLOB_STORAGE_URL)
              encryptPayerUrlToken: $(ENCRYPT_PAYER_URL_TOKEN)
              encryptionKey: $(ENCRYPTION_KEY)
              ezpayTosVersion: $(EZPAY_TOS_VERSION)
              statementsContainerName: $(STATEMENTS_CONTAINER_NAME)
              invoiceContainerName: $(INVOICE_CONTAINER_NAME)
              invoiceBlobConnectionString: $(INVOICE_BLOB_CONNECTION_STRING)
              urlShortenerUrl: $(LOGIC_APP_URL_SHORTENER_URL)
              payerPortalUrl: $(PAYER_PORTAL_BASE_URL)
              productApisOnly: $(PRODUCT_APIS_ONLY)
              apiKind: GQL

- stage: PRD_GRPC_API_Svc_Helm_Deploy
  displayName: PRD - Ezpay API SVC (GRPC) Helm Deploy
  dependsOn: STG_GRPC_API_Svc_Helm_Deploy

  jobs:
  - deployment: Helm_Deploy
    displayName: Helm Deploy
    environment: ezpay-prd

    pool:
      vmImage: 'ubuntu-latest'

    variables:
    - group: ezpay-api-svc-prd
    - template: ../api-svc/helm-variables-prd.yaml

    strategy:
      runOnce:
        deploy:
          steps:
          - template: ../api-svc/helm-deploy-step.yaml
            parameters:
              serviceConnection: 'AzDevOps-Pipeline-Principal-PRD'
              svcPrincipalClientId: $(SVC_PRINCIPAL_CLIENT_ID_PRD)
              svcPrincipalSecret: $(SVC_PRINCIPAL_SECRET_PRD)
              azureTenantId: $(AZURE_TENANT_ID)
              aksName: $(AKS_NAME)
              aksResourceGroup: $(AKS_RESOURCE_GROUP)
              containerRegistryName: $(CONTAINER_REGISTRY_NAME)
              imageRepositoryName: $(IMAGE_REPOSITORY_NAME)
              chartRepositoryName: $(CHART_REPOSITORY_NAME)
              k8sNamespace: $(K8S_NAMESPACE)
              helmReleaseName: $(HELM_RELEASE_NAME)-grpc
              chartName: $(CHART_NAME)
              env: $(ENV)
              replicas: $(REPLICAS)
              frontDoorId: $(FRONT_DOOR_ID)
              kongIngressClass: $(KONG_INGRESS_CLASS)
              kongIngressUpstreamHostHeader: $(KONG_INGRESS_UPSTREAM_HEADER)
              resourceLimitsCpu: $(RESOURCE_LIMITS_CPU)
              resourceLimitsMemory: $(RESOURCE_LIMITS_MEMORY)
              resourceRequestsCpu: $(RESOURCE_REQUESTS_CPU)
              resourceRequestsMemory: $(RESOURCE_REQUESTS_MEMORY)
              appInsightsKey: $(APP_INSIGHTS_INSTRUMENTATION_KEY)
              cosmosConnString: $(COSMOSDB_CONN_STRING)
              cosmosDatabase: $(COSMOSDB_EZPAY_DATABASE)
              cosmosContainer: $(COSMOSDB_DATA_PROJECTIONS_CONTAINER)              
              serviceBusConnectionString: $(SB_CONN_STRING)
              sbEventsTopic: $(SB_PLATFORM_EVENTS_TOPIC)
              sbPlatformEventsSubscription: $(SB_PLATFORM_EVENTS_SUBSCRIPTION)
              sbPlatformEventsTopicConnectionString: $(SB_PLATFORM_EVENTS_TOPIC_CONN_STRING)
              b2cClientId: $(B2C_CLIENT_ID)
              b2cDomainHost: $(B2C_DOMAIN_HOST)
              b2cTenantId: $(B2C_TENANT_ID)
              b2cPolicyName: $(B2C_POLICY_NAME)
              subsMgmtGrpcUrl: $(GRPC_URL_SUBS_MGMT)
              subsMgmtServiceId: $(SUBS_MGMT_SERVICE_ID)
              subsMgmtApiKey: $(SUBS_MGMT_API_KEY)  
              wepayGrpcUrl: $(GRPC_URL_WEPAY_INTEGRATION)
              wepayApiVersion: $(WEPAY_API_VERSION)
              wepayAppId: $(WEPAY_APP_ID)
              wepayAppToken: $(WEPAY_APP_TOKEN)
              paymentsFromPhoneNumber: $(PAYMENTS_PLATFORM_FROM_PHONE_NUMBER)
              paymentsFromEmail: $(PAYMENTS_PLATFORM_FROM_EMAIL)
              processPlatformEvents: $(PROCESS_PLATFORM_EVENTS)
              blobStorageUrl: $(BLOB_STORAGE_URL)
              encryptPayerUrlToken: $(ENCRYPT_PAYER_URL_TOKEN)
              encryptionKey: $(ENCRYPTION_KEY)
              ezpayTosVersion: $(EZPAY_TOS_VERSION)
              statementsContainerName: $(STATEMENTS_CONTAINER_NAME)
              invoiceContainerName: $(INVOICE_CONTAINER_NAME)
              invoiceBlobConnectionString: $(INVOICE_BLOB_CONNECTION_STRING)
              urlShortenerUrl: $(LOGIC_APP_URL_SHORTENER_URL)
              payerPortalUrl: $(PAYER_PORTAL_BASE_URL)
              productApisOnly: $(PRODUCT_APIS_ONLY)
              apiKind: GRPC

## EZPAY PAYFAC NOTIFICATIONS ##
- stage: TST_Payfac_Notifications_Svc_Helm_Deploy
  displayName: TST - Ezpay Payfac Notifications SVC Helm Deploy
  dependsOn: []

  jobs:
  - deployment: Helm_Deploy
    displayName: Helm Deploy
    environment: ezpay-tst

    pool:
      vmImage: 'ubuntu-latest'

    variables:
    - group: ezpay-payfac-notifications-svc-tst
    - template: ../payfac-notifications-svc/helm-variables-tst.yaml

    strategy:
      runOnce:
        deploy:
          steps:
          - template: ../payfac-notifications-svc/helm-deploy-step.yaml
            parameters:
              serviceConnection: 'AzDevOps-Pipeline-Principal-DEV-TST-STG'
              svcPrincipalClientId: $(SVC_PRINCIPAL_CLIENT_ID_SHR)
              svcPrincipalSecret: $(SVC_PRINCIPAL_SECRET_SHR)
              azureTenantId: $(AZURE_TENANT_ID)
              aksName: $(AKS_NAME)
              aksResourceGroup: $(AKS_RESOURCE_GROUP)
              containerRegistryName: $(CONTAINER_REGISTRY_NAME)
              imageRepositoryName: $(IMAGE_REPOSITORY_NAME)
              chartRepositoryName: $(CHART_REPOSITORY_NAME)
              k8sNamespace: $(K8S_NAMESPACE)
              helmReleaseName: $(HELM_RELEASE_NAME)
              chartName: $(CHART_NAME)
              env: $(ENV)
              replicas: $(REPLICAS)
              resourceLimitsCpu: $(RESOURCE_LIMITS_CPU)
              resourceLimitsMemory: $(RESOURCE_LIMITS_MEMORY)
              resourceRequestsCpu: $(RESOURCE_REQUESTS_CPU)
              resourceRequestsMemory: $(RESOURCE_REQUESTS_MEMORY)
              appInsightsKey: $(APP_INSIGHTS_INSTRUMENTATION_KEY)
              wepayGrpcUrl: $(GRPC_URL_WEPAY_INTEGRATION)
              wepayBaseUrl: $(WEPAY_BASE_URL)
              wepayApiVersion: $(WEPAY_API_VERSION)
              wepayAppId: $(WEPAY_APP_ID)
              wepayAppToken: $(WEPAY_APP_TOKEN)
              broadcastPlatformEvents: $(BROADCAST_PLATFORM_EVENTS)
              ezpayWebHookUrl: $(EZPAY_WEBHOOK_URL)
              eventTopicConnectionString: $(SB_PLATFORM_EVENTS_TOPIC_CONN_STRING)
              processPlatformEvents: $(PROCESS_PLATFORM_EVENTS)
              processNotificationEvents: $(PROCESS_NOTIFICATION_EVENTS)
              serviceBusConnectionString: $(SB_CONN_STRING)   
              payfacTopicConnectionString: $(SB_PAYFAC_NOTIFICATIONS_TOPIC_CONN_STRING)
              platformEventsTopic: $(SB_PLATFORM_EVENTS_TOPIC)
              payfacNotificationTopic: $(SB_PAYFAC_NOTIFICATIONS_TOPIC)
              payfacNotificationSubscription: $(SB_PAYFAC_NOTIFICATIONS_SUBSCRIPTION)         

- stage: STG_Payfac_Notifications_Svc_Helm_Deploy
  displayName: STG - Ezpay Payfac Notifications SVC Helm Deploy
  dependsOn: TST_Payfac_Notifications_Svc_Helm_Deploy

  jobs:
  - deployment: Helm_Deploy
    displayName: Helm Deploy
    environment: ezpay-stg

    pool:
      vmImage: 'ubuntu-latest'

    variables:
    - group: ezpay-payfac-notifications-svc-stg
    - template: ../payfac-notifications-svc/helm-variables-stg.yaml

    strategy:
      runOnce:
        deploy:
          steps:
          - template: ../payfac-notifications-svc/helm-deploy-step.yaml
            parameters:
              serviceConnection: 'AzDevOps-Pipeline-Principal-DEV-TST-STG'
              svcPrincipalClientId: $(SVC_PRINCIPAL_CLIENT_ID_SHR)
              svcPrincipalSecret: $(SVC_PRINCIPAL_SECRET_SHR)
              azureTenantId: $(AZURE_TENANT_ID)
              aksName: $(AKS_NAME)
              aksResourceGroup: $(AKS_RESOURCE_GROUP)
              containerRegistryName: $(CONTAINER_REGISTRY_NAME)
              imageRepositoryName: $(IMAGE_REPOSITORY_NAME)
              chartRepositoryName: $(CHART_REPOSITORY_NAME)
              k8sNamespace: $(K8S_NAMESPACE)
              helmReleaseName: $(HELM_RELEASE_NAME)
              chartName: $(CHART_NAME)
              env: $(ENV)
              replicas: $(REPLICAS)
              resourceLimitsCpu: $(RESOURCE_LIMITS_CPU)
              resourceLimitsMemory: $(RESOURCE_LIMITS_MEMORY)
              resourceRequestsCpu: $(RESOURCE_REQUESTS_CPU)
              resourceRequestsMemory: $(RESOURCE_REQUESTS_MEMORY)
              appInsightsKey: $(APP_INSIGHTS_INSTRUMENTATION_KEY)
              wepayGrpcUrl: $(GRPC_URL_WEPAY_INTEGRATION)
              wepayBaseUrl: $(WEPAY_BASE_URL)
              wepayApiVersion: $(WEPAY_API_VERSION)
              wepayAppId: $(WEPAY_APP_ID)
              wepayAppToken: $(WEPAY_APP_TOKEN)
              broadcastPlatformEvents: $(BROADCAST_PLATFORM_EVENTS)
              ezpayWebHookUrl: $(EZPAY_WEBHOOK_URL)
              eventTopicConnectionString: $(SB_PLATFORM_EVENTS_TOPIC_CONN_STRING)
              processPlatformEvents: $(PROCESS_PLATFORM_EVENTS)
              processNotificationEvents: $(PROCESS_NOTIFICATION_EVENTS)
              serviceBusConnectionString: $(SB_CONN_STRING)   
              payfacTopicConnectionString: $(SB_PAYFAC_NOTIFICATIONS_TOPIC_CONN_STRING)
              platformEventsTopic: $(SB_PLATFORM_EVENTS_TOPIC)
              payfacNotificationTopic: $(SB_PAYFAC_NOTIFICATIONS_TOPIC)
              payfacNotificationSubscription: $(SB_PAYFAC_NOTIFICATIONS_SUBSCRIPTION)                   

- stage: PRD_Payfac_Notifications_Svc_Helm_Deploy
  displayName: PRD - Ezpay Payfac Notifications SVC Helm Deploy
  dependsOn: STG_Payfac_Notifications_Svc_Helm_Deploy

  jobs:
  - deployment: Helm_Deploy
    displayName: Helm Deploy
    environment: ezpay-prd

    pool:
      vmImage: 'ubuntu-latest'

    variables:
    - group: ezpay-payfac-notifications-svc-prd
    - template: ../payfac-notifications-svc/helm-variables-prd.yaml

    strategy:
      runOnce:
        deploy:
          steps:
          - template: ../payfac-notifications-svc/helm-deploy-step.yaml
            parameters:
              serviceConnection: 'AzDevOps-Pipeline-Principal-PRD'
              svcPrincipalClientId: $(SVC_PRINCIPAL_CLIENT_ID_PRD)
              svcPrincipalSecret: $(SVC_PRINCIPAL_SECRET_PRD)
              azureTenantId: $(AZURE_TENANT_ID)
              aksName: $(AKS_NAME)
              aksResourceGroup: $(AKS_RESOURCE_GROUP)
              containerRegistryName: $(CONTAINER_REGISTRY_NAME)
              imageRepositoryName: $(IMAGE_REPOSITORY_NAME)
              chartRepositoryName: $(CHART_REPOSITORY_NAME)
              k8sNamespace: $(K8S_NAMESPACE)
              helmReleaseName: $(HELM_RELEASE_NAME)
              chartName: $(CHART_NAME)
              env: $(ENV)
              replicas: $(REPLICAS)
              resourceLimitsCpu: $(RESOURCE_LIMITS_CPU)
              resourceLimitsMemory: $(RESOURCE_LIMITS_MEMORY)
              resourceRequestsCpu: $(RESOURCE_REQUESTS_CPU)
              resourceRequestsMemory: $(RESOURCE_REQUESTS_MEMORY)
              appInsightsKey: $(APP_INSIGHTS_INSTRUMENTATION_KEY)
              wepayGrpcUrl: $(GRPC_URL_WEPAY_INTEGRATION)
              wepayBaseUrl: $(WEPAY_BASE_URL)
              wepayApiVersion: $(WEPAY_API_VERSION)
              wepayAppId: $(WEPAY_APP_ID)
              wepayAppToken: $(WEPAY_APP_TOKEN)
              broadcastPlatformEvents: $(BROADCAST_PLATFORM_EVENTS)
              ezpayWebHookUrl: $(EZPAY_WEBHOOK_URL)
              eventTopicConnectionString: $(SB_PLATFORM_EVENTS_TOPIC_CONN_STRING)
              processPlatformEvents: $(PROCESS_PLATFORM_EVENTS)
              processNotificationEvents: $(PROCESS_NOTIFICATION_EVENTS)
              serviceBusConnectionString: $(SB_CONN_STRING)   
              payfacTopicConnectionString: $(SB_PAYFAC_NOTIFICATIONS_TOPIC_CONN_STRING)
              platformEventsTopic: $(SB_PLATFORM_EVENTS_TOPIC)
              payfacNotificationTopic: $(SB_PAYFAC_NOTIFICATIONS_TOPIC)
              payfacNotificationSubscription: $(SB_PAYFAC_NOTIFICATIONS_SUBSCRIPTION)

## EZPAY EMAIL NOTIFICATIONS ##
- stage: TST_Email_Notification_Svc_Helm_Deploy
  displayName: TST - Ezpay Email Notifications SVC Helm Deploy
  dependsOn: []

  jobs:
  - deployment: Helm_Deploy
    displayName: Helm Deploy
    environment: ezpay-tst

    pool:
      vmImage: 'ubuntu-latest'

    variables:
    - group: ezpay-email-notification-svc-tst
    - template: ../email-notification-svc/helm-variables-tst.yaml

    strategy:
      runOnce:
        deploy:
          steps:
          - template: ../email-notification-svc/helm-deploy-step.yaml
            parameters:
              serviceConnection: 'AzDevOps-Pipeline-Principal-DEV-TST-STG'
              svcPrincipalClientId: $(SVC_PRINCIPAL_CLIENT_ID_SHR)
              svcPrincipalSecret: $(SVC_PRINCIPAL_SECRET_SHR)
              azureTenantId: $(AZURE_TENANT_ID)
              aksName: $(AKS_NAME)
              aksResourceGroup: $(AKS_RESOURCE_GROUP)
              containerRegistryName: $(CONTAINER_REGISTRY_NAME)
              imageRepositoryName: $(IMAGE_REPOSITORY_NAME)
              chartRepositoryName: $(CHART_REPOSITORY_NAME)
              k8sNamespace: $(K8S_NAMESPACE)
              helmReleaseName: $(HELM_RELEASE_NAME)
              chartName: $(CHART_NAME)
              env: $(ENV)
              replicas: $(REPLICAS)
              resourceLimitsCpu: $(RESOURCE_LIMITS_CPU)
              resourceLimitsMemory: $(RESOURCE_LIMITS_MEMORY)
              resourceRequestsCpu: $(RESOURCE_REQUESTS_CPU)
              resourceRequestsMemory: $(RESOURCE_REQUESTS_MEMORY)
              appInsightsKey: $(APP_INSIGHTS_INSTRUMENTATION_KEY)
              wepayGrpcUrl: $(GRPC_URL_WEPAY_INTEGRATION)
              broadcastPlatformEvents: $(BROADCAST_PLATFORM_EVENTS)
              emailTemplateLogoUrl: $(EMAIL_TEMPLATE_LOGO_URL)
              platformEmail: $(PLATFORM_EMAIL)
              platformName: $(PLATFORM_NAME)
              processPlatformEvents: $(PROCESS_PLATFORM_EVENTS)
              merchantPortalUrl: $(MERCHANT_PORTAL_URL)
              payerPortalUrl: $(PAYER_PORTAL_URL)
              sbPlatformEventsSubscription: $(SB_PLATFORM_EVENTS_SUBSCRIPTION)
              serviceBusConnectionString: $(SB_CONN_STRING)
              sbEventsTopic: $(SB_PLATFORM_EVENTS_TOPIC)
              cosmosConnString: $(COSMOSDB_CONN_STRING)
              cosmosDatabase: $(COSMOSDB_DATABASE)
              cosmosContainer: $(COSMOSDB_DATA_PROJECTIONS_COLLECTION)                

- stage: STG_Email_Notification_Svc_Helm_Deploy
  displayName: STG - Ezpay Email Notifications SVC Helm Deploy
  dependsOn: TST_Email_Notification_Svc_Helm_Deploy

  jobs:
  - deployment: Helm_Deploy
    displayName: Helm Deploy
    environment: ezpay-stg

    pool:
      vmImage: 'ubuntu-latest'

    variables:
    - group: ezpay-email-notification-svc-stg
    - template: ../email-notification-svc/helm-variables-stg.yaml

    strategy:
      runOnce:
        deploy:
          steps:
          - template: ../email-notification-svc/helm-deploy-step.yaml
            parameters:
              serviceConnection: 'AzDevOps-Pipeline-Principal-DEV-TST-STG'
              svcPrincipalClientId: $(SVC_PRINCIPAL_CLIENT_ID_SHR)
              svcPrincipalSecret: $(SVC_PRINCIPAL_SECRET_SHR)
              azureTenantId: $(AZURE_TENANT_ID)
              aksName: $(AKS_NAME)
              aksResourceGroup: $(AKS_RESOURCE_GROUP)
              containerRegistryName: $(CONTAINER_REGISTRY_NAME)
              imageRepositoryName: $(IMAGE_REPOSITORY_NAME)
              chartRepositoryName: $(CHART_REPOSITORY_NAME)
              k8sNamespace: $(K8S_NAMESPACE)
              helmReleaseName: $(HELM_RELEASE_NAME)
              chartName: $(CHART_NAME)
              env: $(ENV)
              replicas: $(REPLICAS)
              resourceLimitsCpu: $(RESOURCE_LIMITS_CPU)
              resourceLimitsMemory: $(RESOURCE_LIMITS_MEMORY)
              resourceRequestsCpu: $(RESOURCE_REQUESTS_CPU)
              resourceRequestsMemory: $(RESOURCE_REQUESTS_MEMORY)
              appInsightsKey: $(APP_INSIGHTS_INSTRUMENTATION_KEY)
              wepayGrpcUrl: $(GRPC_URL_WEPAY_INTEGRATION)
              broadcastPlatformEvents: $(BROADCAST_PLATFORM_EVENTS)
              emailTemplateLogoUrl: $(EMAIL_TEMPLATE_LOGO_URL)
              platformEmail: $(PLATFORM_EMAIL)
              platformName: $(PLATFORM_NAME)
              processPlatformEvents: $(PROCESS_PLATFORM_EVENTS)
              merchantPortalUrl: $(MERCHANT_PORTAL_URL)
              payerPortalUrl: $(PAYER_PORTAL_URL)
              sbPlatformEventsSubscription: $(SB_PLATFORM_EVENTS_SUBSCRIPTION)
              serviceBusConnectionString: $(SB_CONN_STRING)
              sbEventsTopic: $(SB_PLATFORM_EVENTS_TOPIC)
              cosmosConnString: $(COSMOSDB_CONN_STRING)
              cosmosDatabase: $(COSMOSDB_DATABASE)
              cosmosContainer: $(COSMOSDB_DATA_PROJECTIONS_COLLECTION)                        

- stage: PRD_Email_Notification_Svc_Helm_Deploy
  displayName: PRD - Ezpay Email Notifications SVC Helm Deploy
  dependsOn: STG_Email_Notification_Svc_Helm_Deploy

  jobs:
  - deployment: Helm_Deploy
    displayName: Helm Deploy
    environment: ezpay-prd

    pool:
      vmImage: 'ubuntu-latest'

    variables:
    - group: ezpay-email-notification-svc-prd
    - template: ../email-notification-svc/helm-variables-prd.yaml

    strategy:
      runOnce:
        deploy:
          steps:
          - template: ../email-notification-svc/helm-deploy-step.yaml
            parameters:
              serviceConnection: 'AzDevOps-Pipeline-Principal-PRD'
              svcPrincipalClientId: $(SVC_PRINCIPAL_CLIENT_ID_PRD)
              svcPrincipalSecret: $(SVC_PRINCIPAL_SECRET_PRD)
              azureTenantId: $(AZURE_TENANT_ID)
              aksName: $(AKS_NAME)
              aksResourceGroup: $(AKS_RESOURCE_GROUP)
              containerRegistryName: $(CONTAINER_REGISTRY_NAME)
              imageRepositoryName: $(IMAGE_REPOSITORY_NAME)
              chartRepositoryName: $(CHART_REPOSITORY_NAME)
              k8sNamespace: $(K8S_NAMESPACE)
              helmReleaseName: $(HELM_RELEASE_NAME)
              chartName: $(CHART_NAME)
              env: $(ENV)
              replicas: $(REPLICAS)
              resourceLimitsCpu: $(RESOURCE_LIMITS_CPU)
              resourceLimitsMemory: $(RESOURCE_LIMITS_MEMORY)
              resourceRequestsCpu: $(RESOURCE_REQUESTS_CPU)
              resourceRequestsMemory: $(RESOURCE_REQUESTS_MEMORY)
              appInsightsKey: $(APP_INSIGHTS_INSTRUMENTATION_KEY)
              wepayGrpcUrl: $(GRPC_URL_WEPAY_INTEGRATION)
              broadcastPlatformEvents: $(BROADCAST_PLATFORM_EVENTS)
              emailTemplateLogoUrl: $(EMAIL_TEMPLATE_LOGO_URL)
              platformEmail: $(PLATFORM_EMAIL)
              platformName: $(PLATFORM_NAME)
              processPlatformEvents: $(PROCESS_PLATFORM_EVENTS)
              merchantPortalUrl: $(MERCHANT_PORTAL_URL)
              payerPortalUrl: $(PAYER_PORTAL_URL)
              sbPlatformEventsSubscription: $(SB_PLATFORM_EVENTS_SUBSCRIPTION)
              serviceBusConnectionString: $(SB_CONN_STRING)
              sbEventsTopic: $(SB_PLATFORM_EVENTS_TOPIC)
              cosmosConnString: $(COSMOSDB_CONN_STRING)
              cosmosDatabase: $(COSMOSDB_DATABASE)
              cosmosContainer: $(COSMOSDB_DATA_PROJECTIONS_COLLECTION)

## EZPAY MERCHANT OPS ##
- stage: TST_Ezpay_Merchant_Ops_Helm_Deploy
  displayName: TST - ezpay-merchant-ops-svc Helm Deploy
  dependsOn: []

  jobs:
  - deployment: Helm_Deploy
    displayName: Helm Deploy
    environment: ezpay-tst

    pool:
      vmImage: 'ubuntu-latest'

    variables:
    - group: ezpay-merchant-ops-svc-tst
    - template: ../merchant-ops-svc/helm-variables-tst.yaml

    strategy:
      runOnce:
        deploy:
          steps:
          - template: ../merchant-ops-svc/helm-deploy-step.yaml
            parameters:
              serviceConnection: 'AzDevOps-Pipeline-Principal-DEV-TST-STG'
              svcPrincipalClientId: $(SVC_PRINCIPAL_CLIENT_ID_SHR)
              svcPrincipalSecret: $(SVC_PRINCIPAL_SECRET_SHR)
              azureTenantId: $(AZURE_TENANT_ID)
              aksName: $(AKS_NAME)
              aksResourceGroup: $(AKS_RESOURCE_GROUP)
              containerRegistryName: $(CONTAINER_REGISTRY_NAME)
              imageRepositoryName: $(IMAGE_REPOSITORY_NAME)
              chartRepositoryName: $(CHART_REPOSITORY_NAME)
              k8sNamespace: $(K8S_NAMESPACE)
              helmReleaseName: $(HELM_RELEASE_NAME)
              chartName: $(CHART_NAME)
              env: $(ENV)
              replicas: $(REPLICAS)
              resourceLimitsCpu: $(RESOURCE_LIMITS_CPU)
              resourceLimitsMemory: $(RESOURCE_LIMITS_MEMORY)
              resourceRequestsCpu: $(RESOURCE_REQUESTS_CPU)
              resourceRequestsMemory: $(RESOURCE_REQUESTS_MEMORY)
              cosmosConnString: $(COSMOSDB_CONN_STRING)
              cosmosDbName: $(COSMOSDB_DB_NAME)
              cosmosContainerName: $(COSMOSDB_CONTAINER_NAME)
              sbConnectionString: $(SB_CONN_STRING)
              eventTopicConnectionString: $(SB_PLATFORM_EVENTS_TOPIC_CONN_STRING)
              sbEventsTopic: $(SB_PLATFORM_EVENTS_TOPIC)
              sbPlatformEventsSubscription: $(SB_PLATFORM_EVENTS_SUBSCRIPTION)
              enableAppInsights: $(ENABLE_APP_INSIGHTS)
              enableK8sAppInsights: $(ENABLE_K8S_APP_INSIGHTS)
              wepayIntegrationGrpcUri: $(WEPAY_INTEGRATION_GRPC_URI)

- stage: STG_Ezpay_Merchant_Ops_Helm_Deploy
  displayName: STG - ezpay-merchant-ops-svc Helm Deploy
  dependsOn: TST_Ezpay_Merchant_Ops_Helm_Deploy

  jobs:
  - deployment: Helm_Deploy
    displayName: Helm Deploy
    environment: ezpay-stg

    pool:
      vmImage: 'ubuntu-latest'

    variables:
    - group: ezpay-merchant-ops-svc-stg
    - template: ../merchant-ops-svc/helm-variables-stg.yaml

    strategy:
      runOnce:
        deploy:
          steps:
          - template: ../merchant-ops-svc/helm-deploy-step.yaml
            parameters:
              serviceConnection: 'AzDevOps-Pipeline-Principal-DEV-TST-STG'
              svcPrincipalClientId: $(SVC_PRINCIPAL_CLIENT_ID_SHR)
              svcPrincipalSecret: $(SVC_PRINCIPAL_SECRET_SHR)
              azureTenantId: $(AZURE_TENANT_ID)
              aksName: $(AKS_NAME)
              aksResourceGroup: $(AKS_RESOURCE_GROUP)
              containerRegistryName: $(CONTAINER_REGISTRY_NAME)
              imageRepositoryName: $(IMAGE_REPOSITORY_NAME)
              chartRepositoryName: $(CHART_REPOSITORY_NAME)
              k8sNamespace: $(K8S_NAMESPACE)
              helmReleaseName: $(HELM_RELEASE_NAME)
              chartName: $(CHART_NAME)
              env: $(ENV)
              replicas: $(REPLICAS)
              resourceLimitsCpu: $(RESOURCE_LIMITS_CPU)
              resourceLimitsMemory: $(RESOURCE_LIMITS_MEMORY)
              resourceRequestsCpu: $(RESOURCE_REQUESTS_CPU)
              resourceRequestsMemory: $(RESOURCE_REQUESTS_MEMORY)
              cosmosConnString: $(COSMOSDB_CONN_STRING)
              cosmosDbName: $(COSMOSDB_DB_NAME)
              cosmosContainerName: $(COSMOSDB_CONTAINER_NAME)
              sbConnectionString: $(SB_CONN_STRING)
              eventTopicConnectionString: $(SB_PLATFORM_EVENTS_TOPIC_CONN_STRING)
              sbEventsTopic: $(SB_PLATFORM_EVENTS_TOPIC)
              sbPlatformEventsSubscription: $(SB_PLATFORM_EVENTS_SUBSCRIPTION)
              enableAppInsights: $(ENABLE_APP_INSIGHTS)
              enableK8sAppInsights: $(ENABLE_K8S_APP_INSIGHTS)
              wepayIntegrationGrpcUri: $(WEPAY_INTEGRATION_GRPC_URI)

- stage: PRD_Ezpay_Merchant_Ops_Helm_Deploy
  displayName: PRD - ezpay-merchant-ops-svc Helm Deploy
  dependsOn: STG_Ezpay_Merchant_Ops_Helm_Deploy

  jobs:
  - deployment: Helm_Deploy
    displayName: Helm Deploy
    environment: ezpay-prd

    pool:
      vmImage: 'ubuntu-latest'

    variables:
    - group: ezpay-merchant-ops-svc-prd
    - template: ../merchant-ops-svc/helm-variables-prd.yaml

    strategy:
      runOnce:
        deploy:
          steps:
          - template: ../merchant-ops-svc/helm-deploy-step.yaml
            parameters:
              serviceConnection: 'AzDevOps-Pipeline-Principal-PRD'
              svcPrincipalClientId: $(SVC_PRINCIPAL_CLIENT_ID_PRD)
              svcPrincipalSecret: $(SVC_PRINCIPAL_SECRET_PRD)
              azureTenantId: $(AZURE_TENANT_ID)
              aksName: $(AKS_NAME)
              aksResourceGroup: $(AKS_RESOURCE_GROUP)
              containerRegistryName: $(CONTAINER_REGISTRY_NAME)
              imageRepositoryName: $(IMAGE_REPOSITORY_NAME)
              chartRepositoryName: $(CHART_REPOSITORY_NAME)
              k8sNamespace: $(K8S_NAMESPACE)
              helmReleaseName: $(HELM_RELEASE_NAME)
              chartName: $(CHART_NAME)
              env: $(ENV)
              replicas: $(REPLICAS)
              resourceLimitsCpu: $(RESOURCE_LIMITS_CPU)
              resourceLimitsMemory: $(RESOURCE_LIMITS_MEMORY)
              resourceRequestsCpu: $(RESOURCE_REQUESTS_CPU)
              resourceRequestsMemory: $(RESOURCE_REQUESTS_MEMORY)
              cosmosConnString: $(COSMOSDB_CONN_STRING)
              cosmosDbName: $(COSMOSDB_DB_NAME)
              cosmosContainerName: $(COSMOSDB_CONTAINER_NAME)
              sbConnectionString: $(SB_CONN_STRING)
              eventTopicConnectionString: $(SB_PLATFORM_EVENTS_TOPIC_CONN_STRING)
              sbEventsTopic: $(SB_PLATFORM_EVENTS_TOPIC)
              sbPlatformEventsSubscription: $(SB_PLATFORM_EVENTS_SUBSCRIPTION)
              enableAppInsights: $(ENABLE_APP_INSIGHTS)
              enableK8sAppInsights: $(ENABLE_K8S_APP_INSIGHTS)
              wepayIntegrationGrpcUri: $(WEPAY_INTEGRATION_GRPC_URI)

## EZPAY PAYMENT OPS ##
- stage: TST_Ezpay_Payment_Ops_Helm_Deploy
  displayName: TST - ezpay-payment-ops-svc Helm Deploy
  dependsOn: []

  jobs:
  - deployment: Helm_Deploy
    displayName: Helm Deploy
    environment: ezpay-tst

    pool:
      vmImage: 'ubuntu-latest'

    variables:
    - group: ezpay-payment-ops-svc-tst
    - template: ../payment-ops-svc/helm-variables-tst.yaml

    strategy:
      runOnce:
        deploy:
          steps:
          - template: ../payment-ops-svc/helm-deploy-step.yaml
            parameters:
              serviceConnection: 'AzDevOps-Pipeline-Principal-DEV-TST-STG'
              svcPrincipalClientId: $(SVC_PRINCIPAL_CLIENT_ID_SHR)
              svcPrincipalSecret: $(SVC_PRINCIPAL_SECRET_SHR)
              azureTenantId: $(AZURE_TENANT_ID)
              aksName: $(AKS_NAME)
              aksResourceGroup: $(AKS_RESOURCE_GROUP)
              containerRegistryName: $(CONTAINER_REGISTRY_NAME)
              imageRepositoryName: $(IMAGE_REPOSITORY_NAME)
              chartRepositoryName: $(CHART_REPOSITORY_NAME)
              k8sNamespace: $(K8S_NAMESPACE)
              helmReleaseName: $(HELM_RELEASE_NAME)
              chartName: $(CHART_NAME)
              env: $(ENV)
              replicas: $(REPLICAS)
              resourceLimitsCpu: $(RESOURCE_LIMITS_CPU)
              resourceLimitsMemory: $(RESOURCE_LIMITS_MEMORY)
              resourceRequestsCpu: $(RESOURCE_REQUESTS_CPU)
              resourceRequestsMemory: $(RESOURCE_REQUESTS_MEMORY)
              cosmosConnString: $(COSMOSDB_CONN_STRING)
              cosmosDbName: $(COSMOSDB_DB_NAME)
              cosmosContainerName: $(COSMOSDB_CONTAINER_NAME)
              sbConnectionString: $(SB_CONN_STRING)
              eventTopicConnectionString: $(SB_PLATFORM_EVENTS_TOPIC_CONN_STRING)
              sbEventsTopic: $(SB_PLATFORM_EVENTS_TOPIC)
              sbPlatformEventsSubscription: $(SB_PLATFORM_EVENTS_SUBSCRIPTION)
              enableAppInsights: $(ENABLE_APP_INSIGHTS)
              enableK8sAppInsights: $(ENABLE_K8S_APP_INSIGHTS)
              wepayIntegrationGrpcUri: $(WEPAY_INTEGRATION_GRPC_URI)
              emailReqsQueueConnString: $(SB_EMAIL_REQS_QUEUE_CONN_STRING)
              emailReqsQueue: $(SB_EMAIL_REQS_QUEUE)
              smsReqsQueueConnString: $(SB_SMS_REQS_QUEUE_CONN_STRING)
              smsReqsQueue: $(SB_SMS_REQS_QUEUE)

- stage: STG_Ezpay_Payment_Ops_Helm_Deploy
  displayName: STG - ezpay-payment-ops-svc Helm Deploy
  dependsOn: TST_Ezpay_Payment_Ops_Helm_Deploy

  jobs:
  - deployment: Helm_Deploy
    displayName: Helm Deploy
    environment: ezpay-stg

    pool:
      vmImage: 'ubuntu-latest'

    variables:
    - group: ezpay-payment-ops-svc-stg
    - template: ../payment-ops-svc/helm-variables-stg.yaml

    strategy:
      runOnce:
        deploy:
          steps:
          - template: ../payment-ops-svc/helm-deploy-step.yaml
            parameters:
              serviceConnection: 'AzDevOps-Pipeline-Principal-DEV-TST-STG'
              svcPrincipalClientId: $(SVC_PRINCIPAL_CLIENT_ID_SHR)
              svcPrincipalSecret: $(SVC_PRINCIPAL_SECRET_SHR)
              azureTenantId: $(AZURE_TENANT_ID)
              aksName: $(AKS_NAME)
              aksResourceGroup: $(AKS_RESOURCE_GROUP)
              containerRegistryName: $(CONTAINER_REGISTRY_NAME)
              imageRepositoryName: $(IMAGE_REPOSITORY_NAME)
              chartRepositoryName: $(CHART_REPOSITORY_NAME)
              k8sNamespace: $(K8S_NAMESPACE)
              helmReleaseName: $(HELM_RELEASE_NAME)
              chartName: $(CHART_NAME)
              env: $(ENV)
              replicas: $(REPLICAS)
              resourceLimitsCpu: $(RESOURCE_LIMITS_CPU)
              resourceLimitsMemory: $(RESOURCE_LIMITS_MEMORY)
              resourceRequestsCpu: $(RESOURCE_REQUESTS_CPU)
              resourceRequestsMemory: $(RESOURCE_REQUESTS_MEMORY)
              cosmosConnString: $(COSMOSDB_CONN_STRING)
              cosmosDbName: $(COSMOSDB_DB_NAME)
              cosmosContainerName: $(COSMOSDB_CONTAINER_NAME)
              sbConnectionString: $(SB_CONN_STRING)
              eventTopicConnectionString: $(SB_PLATFORM_EVENTS_TOPIC_CONN_STRING)
              sbEventsTopic: $(SB_PLATFORM_EVENTS_TOPIC)
              sbPlatformEventsSubscription: $(SB_PLATFORM_EVENTS_SUBSCRIPTION)
              enableAppInsights: $(ENABLE_APP_INSIGHTS)
              enableK8sAppInsights: $(ENABLE_K8S_APP_INSIGHTS)
              wepayIntegrationGrpcUri: $(WEPAY_INTEGRATION_GRPC_URI)
              emailReqsQueueConnString: $(SB_EMAIL_REQS_QUEUE_CONN_STRING)
              emailReqsQueue: $(SB_EMAIL_REQS_QUEUE)
              smsReqsQueueConnString: $(SB_SMS_REQS_QUEUE_CONN_STRING)
              smsReqsQueue: $(SB_SMS_REQS_QUEUE)

- stage: PRD_Ezpay_Payment_Ops_Helm_Deploy
  displayName: PRD - ezpay-payment-ops-svc Helm Deploy
  dependsOn: STG_Ezpay_Payment_Ops_Helm_Deploy

  jobs:
  - deployment: Helm_Deploy
    displayName: Helm Deploy
    environment: ezpay-prd

    pool:
      vmImage: 'ubuntu-latest'

    variables:
    - group: ezpay-payment-ops-svc-prd
    - template: ../payment-ops-svc/helm-variables-prd.yaml

    strategy:
      runOnce:
        deploy:
          steps:
          - template: ../payment-ops-svc/helm-deploy-step.yaml
            parameters:
              serviceConnection: 'AzDevOps-Pipeline-Principal-PRD'
              svcPrincipalClientId: $(SVC_PRINCIPAL_CLIENT_ID_PRD)
              svcPrincipalSecret: $(SVC_PRINCIPAL_SECRET_PRD)
              azureTenantId: $(AZURE_TENANT_ID)
              aksName: $(AKS_NAME)
              aksResourceGroup: $(AKS_RESOURCE_GROUP)
              containerRegistryName: $(CONTAINER_REGISTRY_NAME)
              imageRepositoryName: $(IMAGE_REPOSITORY_NAME)
              chartRepositoryName: $(CHART_REPOSITORY_NAME)
              k8sNamespace: $(K8S_NAMESPACE)
              helmReleaseName: $(HELM_RELEASE_NAME)
              chartName: $(CHART_NAME)
              env: $(ENV)
              replicas: $(REPLICAS)
              resourceLimitsCpu: $(RESOURCE_LIMITS_CPU)
              resourceLimitsMemory: $(RESOURCE_LIMITS_MEMORY)
              resourceRequestsCpu: $(RESOURCE_REQUESTS_CPU)
              resourceRequestsMemory: $(RESOURCE_REQUESTS_MEMORY)
              cosmosConnString: $(COSMOSDB_CONN_STRING)
              cosmosDbName: $(COSMOSDB_DB_NAME)
              cosmosContainerName: $(COSMOSDB_CONTAINER_NAME)
              sbConnectionString: $(SB_CONN_STRING)
              eventTopicConnectionString: $(SB_PLATFORM_EVENTS_TOPIC_CONN_STRING)
              sbEventsTopic: $(SB_PLATFORM_EVENTS_TOPIC)
              sbPlatformEventsSubscription: $(SB_PLATFORM_EVENTS_SUBSCRIPTION)
              enableAppInsights: $(ENABLE_APP_INSIGHTS)
              enableK8sAppInsights: $(ENABLE_K8S_APP_INSIGHTS)
              wepayIntegrationGrpcUri: $(WEPAY_INTEGRATION_GRPC_URI)
              emailReqsQueueConnString: $(SB_EMAIL_REQS_QUEUE_CONN_STRING)
              emailReqsQueue: $(SB_EMAIL_REQS_QUEUE)
              smsReqsQueueConnString: $(SB_SMS_REQS_QUEUE_CONN_STRING)
              smsReqsQueue: $(SB_SMS_REQS_QUEUE)

## EZPAY PAYMENTS SVC ##
- stage: TST_Ezpay_Payments_Svc_Helm_Deploy
  displayName: TST - ezpay-payments-svc Helm Deploy
  dependsOn: []

  jobs:
  - deployment: Helm_Deploy
    displayName: Helm Deploy
    environment: ezpay-tst

    pool:
      vmImage: 'ubuntu-latest'

    variables:
    - group: ezpay-payments-svc-tst
    - template: ../payments-svc/helm-variables-tst.yaml

    strategy:
      runOnce:
        deploy:
          steps:
          - template: ../payments-svc/helm-deploy-step.yaml
            parameters:
              serviceConnection: 'AzDevOps-Pipeline-Principal-DEV-TST-STG'
              svcPrincipalClientId: $(SVC_PRINCIPAL_CLIENT_ID_SHR)
              svcPrincipalSecret: $(SVC_PRINCIPAL_SECRET_SHR)
              azureTenantId: $(AZURE_TENANT_ID)
              aksName: $(AKS_NAME)
              aksResourceGroup: $(AKS_RESOURCE_GROUP)
              containerRegistryName: $(CONTAINER_REGISTRY_NAME)
              imageRepositoryName: $(IMAGE_REPOSITORY_NAME)
              chartRepositoryName: $(CHART_REPOSITORY_NAME)
              k8sNamespace: $(K8S_NAMESPACE)
              helmReleaseName: $(HELM_RELEASE_NAME)
              chartName: $(CHART_NAME)
              env: $(ENV)
              replicas: $(REPLICAS)
              resourceLimitsCpu: $(RESOURCE_LIMITS_CPU)
              resourceLimitsMemory: $(RESOURCE_LIMITS_MEMORY)
              resourceRequestsCpu: $(RESOURCE_REQUESTS_CPU)
              resourceRequestsMemory: $(RESOURCE_REQUESTS_MEMORY)
              executionMode: $(EXECUTION_MODE)
              cosmosConnString: $(COSMOSDB_CONN_STRING)
              cosmosDbName: $(COSMOSDB_DB_NAME)
              cosmosContainerName: $(COSMOSDB_CONTAINER_NAME)
              mongodbConnString: $(MONGODB_CONN_STRING)
              mongodbName: $(MONGODB_DB_NAME)
              mongodbCollectionName: $(MONGODB_COLLECTION_NAME)
              sbConnectionString: $(SB_CONN_STRING)
              eventTopicConnectionString: $(SB_PLATFORM_EVENTS_TOPIC_CONN_STRING)
              sbEventsTopic: $(SB_PLATFORM_EVENTS_TOPIC)
              sbPlatformEventsSubscription: $(SB_PLATFORM_EVENTS_SUBSCRIPTION)
              enableAppInsights: $(ENABLE_APP_INSIGHTS)
              enableK8sAppInsights: $(ENABLE_K8S_APP_INSIGHTS)
              wepayIntegrationGrpcUri: $(WEPAY_INTEGRATION_GRPC_URI)

- stage: TST_Ezpay_Payments_Retry_Job_Helm_Deploy
  displayName: TST - ezpay-payments-retry-job-tst Helm Deploy
  dependsOn: []

  jobs:
  - deployment: Helm_Deploy
    displayName: Helm Deploy
    environment: ezpay-tst

    pool:
      vmImage: 'ubuntu-latest'

    variables:
    - group: ezpay-payments-retry-job-tst
    - template: ../payments-svc/helm-variables-tst.yaml

    strategy:
      runOnce:
        deploy:
          steps:
          - template: ../payments-svc/helm-deploy-step.yaml
            parameters:
              serviceConnection: 'AzDevOps-Pipeline-Principal-DEV-TST-STG'
              svcPrincipalClientId: $(SVC_PRINCIPAL_CLIENT_ID_SHR)
              svcPrincipalSecret: $(SVC_PRINCIPAL_SECRET_SHR)
              azureTenantId: $(AZURE_TENANT_ID)
              aksName: $(AKS_NAME)
              aksResourceGroup: $(AKS_RESOURCE_GROUP)
              containerRegistryName: $(CONTAINER_REGISTRY_NAME)
              imageRepositoryName: $(IMAGE_REPOSITORY_NAME)
              chartRepositoryName: $(CHART_REPOSITORY_NAME)
              k8sNamespace: $(K8S_JOBS_NAMESPACE)
              helmReleaseName: $(HELM_RELEASE_NAME)
              chartName: $(CHART_NAME)
              env: $(ENV)
              replicas: $(REPLICAS)
              resourceLimitsCpu: $(RESOURCE_LIMITS_CPU)
              resourceLimitsMemory: $(RESOURCE_LIMITS_MEMORY)
              resourceRequestsCpu: $(RESOURCE_REQUESTS_CPU)
              resourceRequestsMemory: $(RESOURCE_REQUESTS_MEMORY)
              executionMode: $(EXECUTION_MODE)
              cosmosConnString: $(COSMOSDB_CONN_STRING)
              cosmosDbName: $(COSMOSDB_DB_NAME)
              cosmosContainerName: $(COSMOSDB_CONTAINER_NAME)
              mongodbConnString: $(MONGODB_CONN_STRING)
              mongodbName: $(MONGODB_DB_NAME)
              mongodbCollectionName: $(MONGODB_COLLECTION_NAME)
              sbConnectionString: $(SB_CONN_STRING)
              eventTopicConnectionString: $(SB_PLATFORM_EVENTS_TOPIC_CONN_STRING)
              sbEventsTopic: $(SB_PLATFORM_EVENTS_TOPIC)
              sbPlatformEventsSubscription: $(SB_PLATFORM_EVENTS_SUBSCRIPTION)
              cronSchedule: $(CRON_SCHEDULE)
              successfulJobsHistoryLimit: $(SUCCESSFUL_JOB_HISTORY_LIMIT)
              failedJobsHistoryLimit: $(FAILED_JOB_HISTORY_LIMIT)
              enableAppInsights: $(ENABLE_APP_INSIGHTS)
              enableK8sAppInsights: $(ENABLE_K8S_APP_INSIGHTS)
              wepayIntegrationGrpcUri: $(WEPAY_INTEGRATION_GRPC_URI)

- stage: STG_Ezpay_Payments_Svc_Helm_Deploy
  displayName: STG - ezpay-payments-svc Helm Deploy
  dependsOn: TST_Ezpay_Payments_Svc_Helm_Deploy

  jobs:
  - deployment: Helm_Deploy
    displayName: Helm Deploy
    environment: ezpay-stg

    pool:
      vmImage: 'ubuntu-latest'

    variables:
    - group: ezpay-payments-svc-stg
    - template: ../payments-svc/helm-variables-stg.yaml

    strategy:
      runOnce:
        deploy:
          steps:
          - template: ../payments-svc/helm-deploy-step.yaml
            parameters:
              serviceConnection: 'AzDevOps-Pipeline-Principal-DEV-TST-STG'
              svcPrincipalClientId: $(SVC_PRINCIPAL_CLIENT_ID_SHR)
              svcPrincipalSecret: $(SVC_PRINCIPAL_SECRET_SHR)
              azureTenantId: $(AZURE_TENANT_ID)
              aksName: $(AKS_NAME)
              aksResourceGroup: $(AKS_RESOURCE_GROUP)
              containerRegistryName: $(CONTAINER_REGISTRY_NAME)
              imageRepositoryName: $(IMAGE_REPOSITORY_NAME)
              chartRepositoryName: $(CHART_REPOSITORY_NAME)
              k8sNamespace: $(K8S_NAMESPACE)
              helmReleaseName: $(HELM_RELEASE_NAME)
              chartName: $(CHART_NAME)
              env: $(ENV)
              replicas: $(REPLICAS)
              resourceLimitsCpu: $(RESOURCE_LIMITS_CPU)
              resourceLimitsMemory: $(RESOURCE_LIMITS_MEMORY)
              resourceRequestsCpu: $(RESOURCE_REQUESTS_CPU)
              resourceRequestsMemory: $(RESOURCE_REQUESTS_MEMORY)
              executionMode: $(EXECUTION_MODE)
              cosmosConnString: $(COSMOSDB_CONN_STRING)
              cosmosDbName: $(COSMOSDB_DB_NAME)
              cosmosContainerName: $(COSMOSDB_CONTAINER_NAME)
              mongodbConnString: $(MONGODB_CONN_STRING)
              mongodbName: $(MONGODB_DB_NAME)
              mongodbCollectionName: $(MONGODB_COLLECTION_NAME)
              sbConnectionString: $(SB_CONN_STRING)
              eventTopicConnectionString: $(SB_PLATFORM_EVENTS_TOPIC_CONN_STRING)
              sbEventsTopic: $(SB_PLATFORM_EVENTS_TOPIC)
              sbPlatformEventsSubscription: $(SB_PLATFORM_EVENTS_SUBSCRIPTION)
              enableAppInsights: $(ENABLE_APP_INSIGHTS)
              enableK8sAppInsights: $(ENABLE_K8S_APP_INSIGHTS)
              wepayIntegrationGrpcUri: $(WEPAY_INTEGRATION_GRPC_URI)

- stage: STG_Ezpay_Payments_Retry_Job_Helm_Deploy
  displayName: STG - ezpay-payments-retry-job-stg Helm Deploy
  dependsOn: TST_Ezpay_Payments_Retry_Job_Helm_Deploy

  jobs:
  - deployment: Helm_Deploy
    displayName: Helm Deploy
    environment: ezpay-stg

    pool:
      vmImage: 'ubuntu-latest'

    variables:
    - group: ezpay-payments-retry-job-stg
    - template: ../payments-svc/helm-variables-stg.yaml

    strategy:
      runOnce:
        deploy:
          steps:
          - template: ../payments-svc/helm-deploy-step.yaml
            parameters:
              serviceConnection: 'AzDevOps-Pipeline-Principal-DEV-TST-STG'
              svcPrincipalClientId: $(SVC_PRINCIPAL_CLIENT_ID_SHR)
              svcPrincipalSecret: $(SVC_PRINCIPAL_SECRET_SHR)
              azureTenantId: $(AZURE_TENANT_ID)
              aksName: $(AKS_NAME)
              aksResourceGroup: $(AKS_RESOURCE_GROUP)
              containerRegistryName: $(CONTAINER_REGISTRY_NAME)
              imageRepositoryName: $(IMAGE_REPOSITORY_NAME)
              chartRepositoryName: $(CHART_REPOSITORY_NAME)
              k8sNamespace: $(K8S_JOBS_NAMESPACE)
              helmReleaseName: $(HELM_RELEASE_NAME)
              chartName: $(CHART_NAME)
              env: $(ENV)
              replicas: $(REPLICAS)
              resourceLimitsCpu: $(RESOURCE_LIMITS_CPU)
              resourceLimitsMemory: $(RESOURCE_LIMITS_MEMORY)
              resourceRequestsCpu: $(RESOURCE_REQUESTS_CPU)
              resourceRequestsMemory: $(RESOURCE_REQUESTS_MEMORY)
              executionMode: $(EXECUTION_MODE)
              cosmosConnString: $(COSMOSDB_CONN_STRING)
              cosmosDbName: $(COSMOSDB_DB_NAME)
              cosmosContainerName: $(COSMOSDB_CONTAINER_NAME)
              mongodbConnString: $(MONGODB_CONN_STRING)
              mongodbName: $(MONGODB_DB_NAME)
              mongodbCollectionName: $(MONGODB_COLLECTION_NAME)
              sbConnectionString: $(SB_CONN_STRING)
              eventTopicConnectionString: $(SB_PLATFORM_EVENTS_TOPIC_CONN_STRING)
              sbEventsTopic: $(SB_PLATFORM_EVENTS_TOPIC)
              sbPlatformEventsSubscription: $(SB_PLATFORM_EVENTS_SUBSCRIPTION)
              cronSchedule: $(CRON_SCHEDULE)
              successfulJobsHistoryLimit: $(SUCCESSFUL_JOB_HISTORY_LIMIT)
              failedJobsHistoryLimit: $(FAILED_JOB_HISTORY_LIMIT)
              enableAppInsights: $(ENABLE_APP_INSIGHTS)
              enableK8sAppInsights: $(ENABLE_K8S_APP_INSIGHTS)
              wepayIntegrationGrpcUri: $(WEPAY_INTEGRATION_GRPC_URI)

- stage: PRD_Ezpay_Payments_Svc_Helm_Deploy
  displayName: PRD - ezpay-payments-svc Helm Deploy
  dependsOn: STG_Ezpay_Payments_Svc_Helm_Deploy

  jobs:
  - deployment: Helm_Deploy
    displayName: Helm Deploy
    environment: ezpay-prd

    pool:
      vmImage: 'ubuntu-latest'

    variables:
    - group: ezpay-payments-svc-prd
    - template: ../payments-svc/helm-variables-prd.yaml

    strategy:
      runOnce:
        deploy:
          steps:
          - template: ../payments-svc/helm-deploy-step.yaml
            parameters:
              serviceConnection: 'AzDevOps-Pipeline-Principal-PRD'
              svcPrincipalClientId: $(SVC_PRINCIPAL_CLIENT_ID_PRD)
              svcPrincipalSecret: $(SVC_PRINCIPAL_SECRET_PRD)
              azureTenantId: $(AZURE_TENANT_ID)
              aksName: $(AKS_NAME)
              aksResourceGroup: $(AKS_RESOURCE_GROUP)
              containerRegistryName: $(CONTAINER_REGISTRY_NAME)
              imageRepositoryName: $(IMAGE_REPOSITORY_NAME)
              chartRepositoryName: $(CHART_REPOSITORY_NAME)
              k8sNamespace: $(K8S_NAMESPACE)
              helmReleaseName: $(HELM_RELEASE_NAME)
              chartName: $(CHART_NAME)
              env: $(ENV)
              replicas: $(REPLICAS)
              resourceLimitsCpu: $(RESOURCE_LIMITS_CPU)
              resourceLimitsMemory: $(RESOURCE_LIMITS_MEMORY)
              resourceRequestsCpu: $(RESOURCE_REQUESTS_CPU)
              resourceRequestsMemory: $(RESOURCE_REQUESTS_MEMORY)
              executionMode: $(EXECUTION_MODE)
              cosmosConnString: $(COSMOSDB_CONN_STRING)
              cosmosDbName: $(COSMOSDB_DB_NAME)
              cosmosContainerName: $(COSMOSDB_CONTAINER_NAME)
              mongodbConnString: $(MONGODB_CONN_STRING)
              mongodbName: $(MONGODB_DB_NAME)
              mongodbCollectionName: $(MONGODB_COLLECTION_NAME)
              sbConnectionString: $(SB_CONN_STRING)
              eventTopicConnectionString: $(SB_PLATFORM_EVENTS_TOPIC_CONN_STRING)
              sbEventsTopic: $(SB_PLATFORM_EVENTS_TOPIC)
              sbPlatformEventsSubscription: $(SB_PLATFORM_EVENTS_SUBSCRIPTION)
              enableAppInsights: $(ENABLE_APP_INSIGHTS)
              enableK8sAppInsights: $(ENABLE_K8S_APP_INSIGHTS)
              wepayIntegrationGrpcUri: $(WEPAY_INTEGRATION_GRPC_URI)

- stage: PRD_Ezpay_Payments_Retry_Job_Helm_Deploy
  displayName: PRD - ezpay-payments-retry-job-prd Helm Deploy
  dependsOn: STG_Ezpay_Payments_Retry_Job_Helm_Deploy

  jobs:
  - deployment: Helm_Deploy
    displayName: Helm Deploy
    environment: ezpay-prd

    pool:
      vmImage: 'ubuntu-latest'

    variables:
    - group: ezpay-payments-retry-job-prd
    - template: ../payments-svc/helm-variables-prd.yaml

    strategy:
      runOnce:
        deploy:
          steps:
          - template: ../payments-svc/helm-deploy-step.yaml
            parameters:
              serviceConnection: 'AzDevOps-Pipeline-Principal-PRD'
              svcPrincipalClientId: $(SVC_PRINCIPAL_CLIENT_ID_PRD)
              svcPrincipalSecret: $(SVC_PRINCIPAL_SECRET_PRD)
              azureTenantId: $(AZURE_TENANT_ID)
              aksName: $(AKS_NAME)
              aksResourceGroup: $(AKS_RESOURCE_GROUP)
              containerRegistryName: $(CONTAINER_REGISTRY_NAME)
              imageRepositoryName: $(IMAGE_REPOSITORY_NAME)
              chartRepositoryName: $(CHART_REPOSITORY_NAME)
              k8sNamespace: $(K8S_JOBS_NAMESPACE)
              helmReleaseName: $(HELM_RELEASE_NAME)
              chartName: $(CHART_NAME)
              env: $(ENV)
              replicas: $(REPLICAS)
              resourceLimitsCpu: $(RESOURCE_LIMITS_CPU)
              resourceLimitsMemory: $(RESOURCE_LIMITS_MEMORY)
              resourceRequestsCpu: $(RESOURCE_REQUESTS_CPU)
              resourceRequestsMemory: $(RESOURCE_REQUESTS_MEMORY)
              executionMode: $(EXECUTION_MODE)
              cosmosConnString: $(COSMOSDB_CONN_STRING)
              cosmosDbName: $(COSMOSDB_DB_NAME)
              cosmosContainerName: $(COSMOSDB_CONTAINER_NAME)
              mongodbConnString: $(MONGODB_CONN_STRING)
              mongodbName: $(MONGODB_DB_NAME)
              mongodbCollectionName: $(MONGODB_COLLECTION_NAME)
              sbConnectionString: $(SB_CONN_STRING)
              eventTopicConnectionString: $(SB_PLATFORM_EVENTS_TOPIC_CONN_STRING)
              sbEventsTopic: $(SB_PLATFORM_EVENTS_TOPIC)
              sbPlatformEventsSubscription: $(SB_PLATFORM_EVENTS_SUBSCRIPTION)
              cronSchedule: $(CRON_SCHEDULE)
              successfulJobsHistoryLimit: $(SUCCESSFUL_JOB_HISTORY_LIMIT)
              failedJobsHistoryLimit: $(FAILED_JOB_HISTORY_LIMIT)
              enableAppInsights: $(ENABLE_APP_INSIGHTS)
              enableK8sAppInsights: $(ENABLE_K8S_APP_INSIGHTS)
              wepayIntegrationGrpcUri: $(WEPAY_INTEGRATION_GRPC_URI)

## EZPAY TRANSACTION RECORDS SVC + JOBS ##
- stage: TST_Ezpay_Transaction_Records_Svc_Helm_Deploy
  displayName: TST - ezpay-transaction-records-svc Helm Deploy
  dependsOn: []

  jobs:
  - deployment: Helm_Deploy
    displayName: Helm Deploy
    environment: ezpay-tst

    pool:
      vmImage: 'ubuntu-latest'

    variables:
    - group: ezpay-transaction-records-svc-tst
    - template: ../transaction-records-svc/helm-variables-tst.yaml

    strategy:
      runOnce:
        deploy:
          steps:
          - template: ../transaction-records-svc/helm-deploy-step.yaml
            parameters:
              serviceConnection: 'AzDevOps-Pipeline-Principal-DEV-TST-STG'
              svcPrincipalClientId: $(SVC_PRINCIPAL_CLIENT_ID_SHR)
              svcPrincipalSecret: $(SVC_PRINCIPAL_SECRET_SHR)
              azureTenantId: $(AZURE_TENANT_ID)
              aksName: $(AKS_NAME)
              aksResourceGroup: $(AKS_RESOURCE_GROUP)
              containerRegistryName: $(CONTAINER_REGISTRY_NAME)
              imageRepositoryName: $(IMAGE_REPOSITORY_NAME)
              chartRepositoryName: $(CHART_REPOSITORY_NAME)
              k8sNamespace: $(K8S_NAMESPACE)
              helmReleaseName: $(HELM_RELEASE_NAME)-svc
              chartName: $(CHART_NAME)
              env: $(ENV)
              replicas: $(REPLICAS)
              resourceLimitsCpu: $(RESOURCE_LIMITS_CPU)
              resourceLimitsMemory: $(RESOURCE_LIMITS_MEMORY)
              resourceRequestsCpu: $(RESOURCE_REQUESTS_CPU)
              resourceRequestsMemory: $(RESOURCE_REQUESTS_MEMORY)
              executionMode: $(EXECUTION_MODE)
              broadcastPlatformEvents: $(BROADCAST_PLATFORM_EVENTS)
              cosmosConnString: $(COSMOSDB_CONN_STRING)
              cosmosDatabase: $(COSMOSDB_DATABASE)
              cosmosContainer: $(COSMOSDB_DATA_PROJECTIONS_COLLECTION)
              serviceBusConnectionString: $(SB_CONN_STRING)
              sbEventsTopic: $(SB_PLATFORM_EVENTS_TOPIC)
              sbPlatformEventsSubscription: $(SB_PLATFORM_EVENTS_SUBSCRIPTION)
              appInsightsKey: $(APP_INSIGHTS_INSTRUMENTATION_KEY)
              wepayGrpcUrl: $(GRPC_URL_WEPAY_INTEGRATION)
              processPlatformEvents: $(PROCESS_PLATFORM_EVENTS)
              statementsContainerName: $(STATEMENTS_CONTAINER_NAME)
              statementsPeriod: $(STATEMENT_PERIOD)
              statementsBlobConnString: $(STATEMENTS_BLOB_CONNECTION_STRING)

- stage: TST_Ezpay_Transaction_Records_Retrieve_Job_Helm_Deploy
  displayName: TST - ezpay-transaction-records-retrieve-job Helm Deploy
  dependsOn: []

  jobs:
  - deployment: Helm_Deploy
    displayName: Helm Deploy
    environment: ezpay-tst

    pool:
      vmImage: 'ubuntu-latest'

    variables:
    - group: ezpay-transaction-records-retrieve-job-tst
    - template: ../transaction-records-svc/helm-variables-tst.yaml

    strategy:
      runOnce:
        deploy:
          steps:
          - template: ../transaction-records-svc/helm-deploy-step.yaml
            parameters:
              serviceConnection: 'AzDevOps-Pipeline-Principal-DEV-TST-STG'
              svcPrincipalClientId: $(SVC_PRINCIPAL_CLIENT_ID_SHR)
              svcPrincipalSecret: $(SVC_PRINCIPAL_SECRET_SHR)
              azureTenantId: $(AZURE_TENANT_ID)
              aksName: $(AKS_NAME)
              aksResourceGroup: $(AKS_RESOURCE_GROUP)
              containerRegistryName: $(CONTAINER_REGISTRY_NAME)
              imageRepositoryName: $(IMAGE_REPOSITORY_NAME)
              chartRepositoryName: $(CHART_REPOSITORY_NAME)
              k8sNamespace: $(K8S_JOBS_NAMESPACE)
              helmReleaseName: $(HELM_RELEASE_NAME)-ret-job
              chartName: $(CHART_NAME)
              env: $(ENV)
              replicas: $(REPLICAS)
              resourceLimitsCpu: $(RESOURCE_LIMITS_CPU)
              resourceLimitsMemory: $(RESOURCE_LIMITS_MEMORY)
              resourceRequestsCpu: $(RESOURCE_REQUESTS_CPU)
              resourceRequestsMemory: $(RESOURCE_REQUESTS_MEMORY)
              cronSchedule: $(CRON_SCHEDULE)
              executionMode: $(EXECUTION_MODE)
              broadcastPlatformEvents: $(BROADCAST_PLATFORM_EVENTS)
              cosmosConnString: $(COSMOSDB_CONN_STRING)
              cosmosDatabase: $(COSMOSDB_DATABASE)
              cosmosContainer: $(COSMOSDB_DATA_PROJECTIONS_COLLECTION)
              serviceBusConnectionString: $(SB_CONN_STRING)
              sbEventsTopic: $(SB_PLATFORM_EVENTS_TOPIC)
              sbPlatformEventsSubscription: $(SB_PLATFORM_EVENTS_SUBSCRIPTION)
              appInsightsKey: $(APP_INSIGHTS_INSTRUMENTATION_KEY)
              wepayGrpcUrl: $(GRPC_URL_WEPAY_INTEGRATION)
              processPlatformEvents: $(PROCESS_PLATFORM_EVENTS)
              statementsContainerName: $(STATEMENTS_CONTAINER_NAME)
              statementsPeriod: $(STATEMENT_PERIOD)
              statementsBlobConnString: $(STATEMENTS_BLOB_CONNECTION_STRING)
              successfulJobsHistoryLimit: $(SUCCESSFUL_JOB_HISTORY_LIMIT)
              failedJobsHistoryLimit: $(FAILED_JOB_HISTORY_LIMIT)

- stage: TST_Ezpay_Transaction_Records_Stmts_Job_Helm_Deploy
  displayName: TST - ezpay-transaction-records-stmts-job Helm Deploy
  dependsOn: []

  jobs:
  - deployment: Helm_Deploy
    displayName: Helm Deploy
    environment: ezpay-tst

    pool:
      vmImage: 'ubuntu-latest'

    variables:
    - group: ezpay-transaction-stmts-job-tst
    - template: ../transaction-records-svc/helm-variables-tst.yaml

    strategy:
      runOnce:
        deploy:
          steps:
          - template: ../transaction-records-svc/helm-deploy-step.yaml
            parameters:
              serviceConnection: 'AzDevOps-Pipeline-Principal-DEV-TST-STG'
              svcPrincipalClientId: $(SVC_PRINCIPAL_CLIENT_ID_SHR)
              svcPrincipalSecret: $(SVC_PRINCIPAL_SECRET_SHR)
              azureTenantId: $(AZURE_TENANT_ID)
              aksName: $(AKS_NAME)
              aksResourceGroup: $(AKS_RESOURCE_GROUP)
              containerRegistryName: $(CONTAINER_REGISTRY_NAME)
              imageRepositoryName: $(IMAGE_REPOSITORY_NAME)
              chartRepositoryName: $(CHART_REPOSITORY_NAME)
              k8sNamespace: $(K8S_JOBS_NAMESPACE)
              helmReleaseName: $(HELM_RELEASE_NAME)-stmts-job
              chartName: $(CHART_NAME)
              env: $(ENV)
              replicas: $(REPLICAS)
              resourceLimitsCpu: $(RESOURCE_LIMITS_CPU)
              resourceLimitsMemory: $(RESOURCE_LIMITS_MEMORY)
              resourceRequestsCpu: $(RESOURCE_REQUESTS_CPU)
              resourceRequestsMemory: $(RESOURCE_REQUESTS_MEMORY)
              cronSchedule: $(CRON_SCHEDULE)
              executionMode: $(EXECUTION_MODE)
              broadcastPlatformEvents: $(BROADCAST_PLATFORM_EVENTS)
              cosmosConnString: $(COSMOSDB_CONN_STRING)
              cosmosDatabase: $(COSMOSDB_DATABASE)
              cosmosContainer: $(COSMOSDB_DATA_PROJECTIONS_COLLECTION)
              serviceBusConnectionString: $(SB_CONN_STRING)
              sbEventsTopic: $(SB_PLATFORM_EVENTS_TOPIC)
              sbPlatformEventsSubscription: $(SB_PLATFORM_EVENTS_SUBSCRIPTION)
              appInsightsKey: $(APP_INSIGHTS_INSTRUMENTATION_KEY)
              wepayGrpcUrl: $(GRPC_URL_WEPAY_INTEGRATION)
              processPlatformEvents: $(PROCESS_PLATFORM_EVENTS)
              statementsContainerName: $(STATEMENTS_CONTAINER_NAME)
              statementsPeriod: $(STATEMENT_PERIOD)
              statementsBlobConnString: $(STATEMENTS_BLOB_CONNECTION_STRING)
              successfulJobsHistoryLimit: $(SUCCESSFUL_JOB_HISTORY_LIMIT)
              failedJobsHistoryLimit: $(FAILED_JOB_HISTORY_LIMIT)

- stage: STG_Ezpay_Transaction_Records_Svc_Helm_Deploy
  displayName: STG - ezpay-transaction-records-svc Helm Deploy
  dependsOn: TST_Ezpay_Transaction_Records_Svc_Helm_Deploy

  jobs:
  - deployment: Helm_Deploy
    displayName: Helm Deploy
    environment: ezpay-stg

    pool:
      vmImage: 'ubuntu-latest'

    variables:
    - group: ezpay-transaction-records-svc-stg
    - template: ../transaction-records-svc/helm-variables-stg.yaml

    strategy:
      runOnce:
        deploy:
          steps:
          - template: ../transaction-records-svc/helm-deploy-step.yaml
            parameters:
              serviceConnection: 'AzDevOps-Pipeline-Principal-DEV-TST-STG'
              svcPrincipalClientId: $(SVC_PRINCIPAL_CLIENT_ID_SHR)
              svcPrincipalSecret: $(SVC_PRINCIPAL_SECRET_SHR)
              azureTenantId: $(AZURE_TENANT_ID)
              aksName: $(AKS_NAME)
              aksResourceGroup: $(AKS_RESOURCE_GROUP)
              containerRegistryName: $(CONTAINER_REGISTRY_NAME)
              imageRepositoryName: $(IMAGE_REPOSITORY_NAME)
              chartRepositoryName: $(CHART_REPOSITORY_NAME)
              k8sNamespace: $(K8S_NAMESPACE)
              helmReleaseName: $(HELM_RELEASE_NAME)-svc
              chartName: $(CHART_NAME)
              env: $(ENV)
              replicas: $(REPLICAS)
              resourceLimitsCpu: $(RESOURCE_LIMITS_CPU)
              resourceLimitsMemory: $(RESOURCE_LIMITS_MEMORY)
              resourceRequestsCpu: $(RESOURCE_REQUESTS_CPU)
              resourceRequestsMemory: $(RESOURCE_REQUESTS_MEMORY)
              executionMode: $(EXECUTION_MODE)
              broadcastPlatformEvents: $(BROADCAST_PLATFORM_EVENTS)
              cosmosConnString: $(COSMOSDB_CONN_STRING)
              cosmosDatabase: $(COSMOSDB_DATABASE)
              cosmosContainer: $(COSMOSDB_DATA_PROJECTIONS_COLLECTION)
              serviceBusConnectionString: $(SB_CONN_STRING)
              sbEventsTopic: $(SB_PLATFORM_EVENTS_TOPIC)
              sbPlatformEventsSubscription: $(SB_PLATFORM_EVENTS_SUBSCRIPTION)
              appInsightsKey: $(APP_INSIGHTS_INSTRUMENTATION_KEY)
              wepayGrpcUrl: $(GRPC_URL_WEPAY_INTEGRATION)
              processPlatformEvents: $(PROCESS_PLATFORM_EVENTS)
              statementsContainerName: $(STATEMENTS_CONTAINER_NAME)
              statementsPeriod: $(STATEMENT_PERIOD)
              statementsBlobConnString: $(STATEMENTS_BLOB_CONNECTION_STRING)

- stage: STG_Ezpay_Transaction_Records_Retrieve_Job_Helm_Deploy
  displayName: STG - ezpay-transaction-records-retrieve-job Helm Deploy
  dependsOn: TST_Ezpay_Transaction_Records_Retrieve_Job_Helm_Deploy

  jobs:
  - deployment: Helm_Deploy
    displayName: Helm Deploy
    environment: ezpay-stg

    pool:
      vmImage: 'ubuntu-latest'

    variables:
    - group: ezpay-transaction-records-retrieve-job-stg
    - template: ../transaction-records-svc/helm-variables-stg.yaml

    strategy:
      runOnce:
        deploy:
          steps:
          - template: ../transaction-records-svc/helm-deploy-step.yaml
            parameters:
              serviceConnection: 'AzDevOps-Pipeline-Principal-DEV-TST-STG'
              svcPrincipalClientId: $(SVC_PRINCIPAL_CLIENT_ID_SHR)
              svcPrincipalSecret: $(SVC_PRINCIPAL_SECRET_SHR)
              azureTenantId: $(AZURE_TENANT_ID)
              aksName: $(AKS_NAME)
              aksResourceGroup: $(AKS_RESOURCE_GROUP)
              containerRegistryName: $(CONTAINER_REGISTRY_NAME)
              imageRepositoryName: $(IMAGE_REPOSITORY_NAME)
              chartRepositoryName: $(CHART_REPOSITORY_NAME)
              k8sNamespace: $(K8S_JOBS_NAMESPACE)
              helmReleaseName: $(HELM_RELEASE_NAME)-ret-job
              chartName: $(CHART_NAME)
              env: $(ENV)
              replicas: $(REPLICAS)
              resourceLimitsCpu: $(RESOURCE_LIMITS_CPU)
              resourceLimitsMemory: $(RESOURCE_LIMITS_MEMORY)
              resourceRequestsCpu: $(RESOURCE_REQUESTS_CPU)
              resourceRequestsMemory: $(RESOURCE_REQUESTS_MEMORY)
              cronSchedule: $(CRON_SCHEDULE)
              executionMode: $(EXECUTION_MODE)
              broadcastPlatformEvents: $(BROADCAST_PLATFORM_EVENTS)
              cosmosConnString: $(COSMOSDB_CONN_STRING)
              cosmosDatabase: $(COSMOSDB_DATABASE)
              cosmosContainer: $(COSMOSDB_DATA_PROJECTIONS_COLLECTION)
              serviceBusConnectionString: $(SB_CONN_STRING)
              sbEventsTopic: $(SB_PLATFORM_EVENTS_TOPIC)
              sbPlatformEventsSubscription: $(SB_PLATFORM_EVENTS_SUBSCRIPTION)
              appInsightsKey: $(APP_INSIGHTS_INSTRUMENTATION_KEY)
              wepayGrpcUrl: $(GRPC_URL_WEPAY_INTEGRATION)
              processPlatformEvents: $(PROCESS_PLATFORM_EVENTS)
              statementsContainerName: $(STATEMENTS_CONTAINER_NAME)
              statementsPeriod: $(STATEMENT_PERIOD)
              statementsBlobConnString: $(STATEMENTS_BLOB_CONNECTION_STRING)
              successfulJobsHistoryLimit: $(SUCCESSFUL_JOB_HISTORY_LIMIT)
              failedJobsHistoryLimit: $(FAILED_JOB_HISTORY_LIMIT)

- stage: STG_Ezpay_Transaction_Records_Stmts_Job_Helm_Deploy
  displayName: STG - ezpay-transaction-records-stmts-job Helm Deploy
  dependsOn: TST_Ezpay_Transaction_Records_Stmts_Job_Helm_Deploy

  jobs:
  - deployment: Helm_Deploy
    displayName: Helm Deploy
    environment: ezpay-stg

    pool:
      vmImage: 'ubuntu-latest'

    variables:
    - group: ezpay-transaction-stmts-job-stg
    - template: ../transaction-records-svc/helm-variables-stg.yaml

    strategy:
      runOnce:
        deploy:
          steps:
          - template: ../transaction-records-svc/helm-deploy-step.yaml
            parameters:
              serviceConnection: 'AzDevOps-Pipeline-Principal-DEV-TST-STG'
              svcPrincipalClientId: $(SVC_PRINCIPAL_CLIENT_ID_SHR)
              svcPrincipalSecret: $(SVC_PRINCIPAL_SECRET_SHR)
              azureTenantId: $(AZURE_TENANT_ID)
              aksName: $(AKS_NAME)
              aksResourceGroup: $(AKS_RESOURCE_GROUP)
              containerRegistryName: $(CONTAINER_REGISTRY_NAME)
              imageRepositoryName: $(IMAGE_REPOSITORY_NAME)
              chartRepositoryName: $(CHART_REPOSITORY_NAME)
              k8sNamespace: $(K8S_JOBS_NAMESPACE)
              helmReleaseName: $(HELM_RELEASE_NAME)-stmts-job
              chartName: $(CHART_NAME)
              env: $(ENV)
              replicas: $(REPLICAS)
              resourceLimitsCpu: $(RESOURCE_LIMITS_CPU)
              resourceLimitsMemory: $(RESOURCE_LIMITS_MEMORY)
              resourceRequestsCpu: $(RESOURCE_REQUESTS_CPU)
              resourceRequestsMemory: $(RESOURCE_REQUESTS_MEMORY)
              cronSchedule: $(CRON_SCHEDULE)
              executionMode: $(EXECUTION_MODE)
              broadcastPlatformEvents: $(BROADCAST_PLATFORM_EVENTS)
              cosmosConnString: $(COSMOSDB_CONN_STRING)
              cosmosDatabase: $(COSMOSDB_DATABASE)
              cosmosContainer: $(COSMOSDB_DATA_PROJECTIONS_COLLECTION)
              serviceBusConnectionString: $(SB_CONN_STRING)
              sbEventsTopic: $(SB_PLATFORM_EVENTS_TOPIC)
              sbPlatformEventsSubscription: $(SB_PLATFORM_EVENTS_SUBSCRIPTION)
              appInsightsKey: $(APP_INSIGHTS_INSTRUMENTATION_KEY)
              wepayGrpcUrl: $(GRPC_URL_WEPAY_INTEGRATION)
              processPlatformEvents: $(PROCESS_PLATFORM_EVENTS)
              statementsContainerName: $(STATEMENTS_CONTAINER_NAME)
              statementsPeriod: $(STATEMENT_PERIOD)
              statementsBlobConnString: $(STATEMENTS_BLOB_CONNECTION_STRING)
              successfulJobsHistoryLimit: $(SUCCESSFUL_JOB_HISTORY_LIMIT)
              failedJobsHistoryLimit: $(FAILED_JOB_HISTORY_LIMIT)

- stage: PRD_Ezpay_Transaction_Records_Svc_Helm_Deploy
  displayName: PRD - ezpay-transaction-records-svc Helm Deploy
  dependsOn: STG_Ezpay_Transaction_Records_Svc_Helm_Deploy

  jobs:
  - deployment: Helm_Deploy
    displayName: Helm Deploy
    environment: ezpay-prd

    pool:
      vmImage: 'ubuntu-latest'

    variables:
    - group: ezpay-transaction-records-svc-prd
    - template: ../transaction-records-svc/helm-variables-prd.yaml

    strategy:
      runOnce:
        deploy:
          steps:
          - template: ../transaction-records-svc/helm-deploy-step.yaml
            parameters:
              serviceConnection: 'AzDevOps-Pipeline-Principal-PRD'
              svcPrincipalClientId: $(SVC_PRINCIPAL_CLIENT_ID_PRD)
              svcPrincipalSecret: $(SVC_PRINCIPAL_SECRET_PRD)
              azureTenantId: $(AZURE_TENANT_ID)
              aksName: $(AKS_NAME)
              aksResourceGroup: $(AKS_RESOURCE_GROUP)
              containerRegistryName: $(CONTAINER_REGISTRY_NAME)
              imageRepositoryName: $(IMAGE_REPOSITORY_NAME)
              chartRepositoryName: $(CHART_REPOSITORY_NAME)
              k8sNamespace: $(K8S_NAMESPACE)
              helmReleaseName: $(HELM_RELEASE_NAME)-svc
              chartName: $(CHART_NAME)
              env: $(ENV)
              replicas: $(REPLICAS)
              resourceLimitsCpu: $(RESOURCE_LIMITS_CPU)
              resourceLimitsMemory: $(RESOURCE_LIMITS_MEMORY)
              resourceRequestsCpu: $(RESOURCE_REQUESTS_CPU)
              resourceRequestsMemory: $(RESOURCE_REQUESTS_MEMORY)
              executionMode: $(EXECUTION_MODE)
              broadcastPlatformEvents: $(BROADCAST_PLATFORM_EVENTS)
              cosmosConnString: $(COSMOSDB_CONN_STRING)
              cosmosDatabase: $(COSMOSDB_DATABASE)
              cosmosContainer: $(COSMOSDB_DATA_PROJECTIONS_COLLECTION)
              serviceBusConnectionString: $(SB_CONN_STRING)
              sbEventsTopic: $(SB_PLATFORM_EVENTS_TOPIC)
              sbPlatformEventsSubscription: $(SB_PLATFORM_EVENTS_SUBSCRIPTION)
              appInsightsKey: $(APP_INSIGHTS_INSTRUMENTATION_KEY)
              wepayGrpcUrl: $(GRPC_URL_WEPAY_INTEGRATION)
              processPlatformEvents: $(PROCESS_PLATFORM_EVENTS)
              statementsContainerName: $(STATEMENTS_CONTAINER_NAME)
              statementsPeriod: $(STATEMENT_PERIOD)
              statementsBlobConnString: $(STATEMENTS_BLOB_CONNECTION_STRING)

- stage: PRD_Ezpay_Transaction_Records_Retrieve_Job_Helm_Deploy
  displayName: PRD - ezpay-transaction-records-retrieve-job Helm Deploy
  dependsOn: STG_Ezpay_Transaction_Records_Retrieve_Job_Helm_Deploy

  jobs:
  - deployment: Helm_Deploy
    displayName: Helm Deploy
    environment: ezpay-prd

    pool:
      vmImage: 'ubuntu-latest'

    variables:
    - group: ezpay-transaction-records-retrieve-job-prd
    - template: ../transaction-records-svc/helm-variables-prd.yaml

    strategy:
      runOnce:
        deploy:
          steps:
          - template: ../transaction-records-svc/helm-deploy-step.yaml
            parameters:
              serviceConnection: 'AzDevOps-Pipeline-Principal-PRD'
              svcPrincipalClientId: $(SVC_PRINCIPAL_CLIENT_ID_PRD)
              svcPrincipalSecret: $(SVC_PRINCIPAL_SECRET_PRD)
              azureTenantId: $(AZURE_TENANT_ID)
              aksName: $(AKS_NAME)
              aksResourceGroup: $(AKS_RESOURCE_GROUP)
              containerRegistryName: $(CONTAINER_REGISTRY_NAME)
              imageRepositoryName: $(IMAGE_REPOSITORY_NAME)
              chartRepositoryName: $(CHART_REPOSITORY_NAME)
              k8sNamespace: $(K8S_JOBS_NAMESPACE)
              helmReleaseName: $(HELM_RELEASE_NAME)-ret-job
              chartName: $(CHART_NAME)
              env: $(ENV)
              replicas: $(REPLICAS)
              resourceLimitsCpu: $(RESOURCE_LIMITS_CPU)
              resourceLimitsMemory: $(RESOURCE_LIMITS_MEMORY)
              resourceRequestsCpu: $(RESOURCE_REQUESTS_CPU)
              resourceRequestsMemory: $(RESOURCE_REQUESTS_MEMORY)
              cronSchedule: $(CRON_SCHEDULE)
              executionMode: $(EXECUTION_MODE)
              broadcastPlatformEvents: $(BROADCAST_PLATFORM_EVENTS)
              cosmosConnString: $(COSMOSDB_CONN_STRING)
              cosmosDatabase: $(COSMOSDB_DATABASE)
              cosmosContainer: $(COSMOSDB_DATA_PROJECTIONS_COLLECTION)
              serviceBusConnectionString: $(SB_CONN_STRING)
              sbEventsTopic: $(SB_PLATFORM_EVENTS_TOPIC)
              sbPlatformEventsSubscription: $(SB_PLATFORM_EVENTS_SUBSCRIPTION)
              appInsightsKey: $(APP_INSIGHTS_INSTRUMENTATION_KEY)
              wepayGrpcUrl: $(GRPC_URL_WEPAY_INTEGRATION)
              processPlatformEvents: $(PROCESS_PLATFORM_EVENTS)
              statementsContainerName: $(STATEMENTS_CONTAINER_NAME)
              statementsPeriod: $(STATEMENT_PERIOD)
              statementsBlobConnString: $(STATEMENTS_BLOB_CONNECTION_STRING)
              successfulJobsHistoryLimit: $(SUCCESSFUL_JOB_HISTORY_LIMIT)
              failedJobsHistoryLimit: $(FAILED_JOB_HISTORY_LIMIT)

- stage: PRD_Ezpay_Transaction_Records_Stmts_Job_Helm_Deploy
  displayName: PRD - ezpay-transaction-records-stmts-job Helm Deploy
  dependsOn: STG_Ezpay_Transaction_Records_Stmts_Job_Helm_Deploy

  jobs:
  - deployment: Helm_Deploy
    displayName: Helm Deploy
    environment: ezpay-prd

    pool:
      vmImage: 'ubuntu-latest'

    variables:
    - group: ezpay-transaction-stmts-job-prd
    - template: ../transaction-records-svc/helm-variables-prd.yaml

    strategy:
      runOnce:
        deploy:
          steps:
          - template: ../transaction-records-svc/helm-deploy-step.yaml
            parameters:
              serviceConnection: 'AzDevOps-Pipeline-Principal-PRD'
              svcPrincipalClientId: $(SVC_PRINCIPAL_CLIENT_ID_PRD)
              svcPrincipalSecret: $(SVC_PRINCIPAL_SECRET_PRD)
              azureTenantId: $(AZURE_TENANT_ID)
              aksName: $(AKS_NAME)
              aksResourceGroup: $(AKS_RESOURCE_GROUP)
              containerRegistryName: $(CONTAINER_REGISTRY_NAME)
              imageRepositoryName: $(IMAGE_REPOSITORY_NAME)
              chartRepositoryName: $(CHART_REPOSITORY_NAME)
              k8sNamespace: $(K8S_JOBS_NAMESPACE)
              helmReleaseName: $(HELM_RELEASE_NAME)-stmts-job
              chartName: $(CHART_NAME)
              env: $(ENV)
              replicas: $(REPLICAS)
              resourceLimitsCpu: $(RESOURCE_LIMITS_CPU)
              resourceLimitsMemory: $(RESOURCE_LIMITS_MEMORY)
              resourceRequestsCpu: $(RESOURCE_REQUESTS_CPU)
              resourceRequestsMemory: $(RESOURCE_REQUESTS_MEMORY)
              cronSchedule: $(CRON_SCHEDULE)
              executionMode: $(EXECUTION_MODE)
              broadcastPlatformEvents: $(BROADCAST_PLATFORM_EVENTS)
              cosmosConnString: $(COSMOSDB_CONN_STRING)
              cosmosDatabase: $(COSMOSDB_DATABASE)
              cosmosContainer: $(COSMOSDB_DATA_PROJECTIONS_COLLECTION)
              serviceBusConnectionString: $(SB_CONN_STRING)
              sbEventsTopic: $(SB_PLATFORM_EVENTS_TOPIC)
              sbPlatformEventsSubscription: $(SB_PLATFORM_EVENTS_SUBSCRIPTION)
              appInsightsKey: $(APP_INSIGHTS_INSTRUMENTATION_KEY)
              wepayGrpcUrl: $(GRPC_URL_WEPAY_INTEGRATION)
              processPlatformEvents: $(PROCESS_PLATFORM_EVENTS)
              statementsContainerName: $(STATEMENTS_CONTAINER_NAME)
              statementsPeriod: $(STATEMENT_PERIOD)
              statementsBlobConnString: $(STATEMENTS_BLOB_CONNECTION_STRING)
              successfulJobsHistoryLimit: $(SUCCESSFUL_JOB_HISTORY_LIMIT)
              failedJobsHistoryLimit: $(FAILED_JOB_HISTORY_LIMIT)

## EZPAY WEPAY INTEGRATION ##
- stage: TST_Wepay_Integration_Svc_Helm_Deploy
  displayName: TST - wepay-integration-svc Helm Deploy
  dependsOn: []

  jobs:
  - deployment: Helm_Deploy
    displayName: Helm Deploy
    environment: ezpay-tst

    pool:
      vmImage: 'ubuntu-latest'

    variables:
    - group: wepay-integration-svc-tst
    - template: ../wepay-integration-svc/helm-variables-tst.yaml

    strategy:
      runOnce:
        deploy:
          steps:
          - template: ../wepay-integration-svc/helm-deploy-step.yaml
            parameters:
              serviceConnection: 'AzDevOps-Pipeline-Principal-DEV-TST-STG'
              svcPrincipalClientId: $(SVC_PRINCIPAL_CLIENT_ID_SHR)
              svcPrincipalSecret: $(SVC_PRINCIPAL_SECRET_SHR)
              azureTenantId: $(AZURE_TENANT_ID)
              aksName: $(AKS_NAME)
              aksResourceGroup: $(AKS_RESOURCE_GROUP)
              containerRegistryName: $(CONTAINER_REGISTRY_NAME)
              imageRepositoryName: $(IMAGE_REPOSITORY_NAME)
              chartRepositoryName: $(CHART_REPOSITORY_NAME)
              k8sNamespace: $(K8S_NAMESPACE)
              helmReleaseName: $(HELM_RELEASE_NAME)
              chartName: $(CHART_NAME)
              env: $(ENV)
              replicas: $(REPLICAS)
              resourceLimitsCpu: $(RESOURCE_LIMITS_CPU)
              resourceLimitsMemory: $(RESOURCE_LIMITS_MEMORY)
              resourceRequestsCpu: $(RESOURCE_REQUESTS_CPU)
              resourceRequestsMemory: $(RESOURCE_REQUESTS_MEMORY)
              wepayBaseUrl: $(WEPAY_BASE_URL)
              wepayApiVersion: $(WEPAY_API_VERSION)
              wepayAppId: $(WEPAY_APP_ID)
              wepayAppToken: $(WEPAY_APP_TOKEN)
              wepayUploadBaseUrl: $(WEPAY_UPLOAD_BASE_URL)

- stage: STG_Wepay_Integration_Svc_Helm_Deploy
  displayName: STG - wepay-integration-svc Helm Deploy
  dependsOn: TST_Wepay_Integration_Svc_Helm_Deploy

  jobs:
  - deployment: Helm_Deploy
    displayName: Helm Deploy
    environment: ezpay-stg

    pool:
      vmImage: 'ubuntu-latest'

    variables:
    - group: wepay-integration-svc-stg
    - template: ../wepay-integration-svc/helm-variables-stg.yaml

    strategy:
      runOnce:
        deploy:
          steps:
          - template: ../wepay-integration-svc/helm-deploy-step.yaml
            parameters:
              serviceConnection: 'AzDevOps-Pipeline-Principal-DEV-TST-STG'
              svcPrincipalClientId: $(SVC_PRINCIPAL_CLIENT_ID_SHR)
              svcPrincipalSecret: $(SVC_PRINCIPAL_SECRET_SHR)
              azureTenantId: $(AZURE_TENANT_ID)
              aksName: $(AKS_NAME)
              aksResourceGroup: $(AKS_RESOURCE_GROUP)
              containerRegistryName: $(CONTAINER_REGISTRY_NAME)
              imageRepositoryName: $(IMAGE_REPOSITORY_NAME)
              chartRepositoryName: $(CHART_REPOSITORY_NAME)
              k8sNamespace: $(K8S_NAMESPACE)
              helmReleaseName: $(HELM_RELEASE_NAME)
              chartName: $(CHART_NAME)
              env: $(ENV)
              replicas: $(REPLICAS)
              resourceLimitsCpu: $(RESOURCE_LIMITS_CPU)
              resourceLimitsMemory: $(RESOURCE_LIMITS_MEMORY)
              resourceRequestsCpu: $(RESOURCE_REQUESTS_CPU)
              resourceRequestsMemory: $(RESOURCE_REQUESTS_MEMORY)
              wepayBaseUrl: $(WEPAY_BASE_URL)
              wepayApiVersion: $(WEPAY_API_VERSION)
              wepayAppId: $(WEPAY_APP_ID)
              wepayAppToken: $(WEPAY_APP_TOKEN)
              wepayUploadBaseUrl: $(WEPAY_UPLOAD_BASE_URL)

- stage: PRD_Wepay_Integration_Svc_Helm_Deploy
  displayName: PRD - wepay-integration-svc Helm Deploy
  dependsOn: STG_Wepay_Integration_Svc_Helm_Deploy

  jobs:
  - deployment: Helm_Deploy
    displayName: Helm Deploy
    environment: ezpay-prd

    pool:
      vmImage: 'ubuntu-latest'

    variables:
    - group: wepay-integration-svc-prd
    - template: ../wepay-integration-svc/helm-variables-prd.yaml

    strategy:
      runOnce:
        deploy:
          steps:
          - template: ../wepay-integration-svc/helm-deploy-step.yaml
            parameters:
              serviceConnection: 'AzDevOps-Pipeline-Principal-PRD'
              svcPrincipalClientId: $(SVC_PRINCIPAL_CLIENT_ID_PRD)
              svcPrincipalSecret: $(SVC_PRINCIPAL_SECRET_PRD)
              azureTenantId: $(AZURE_TENANT_ID)
              aksName: $(AKS_NAME)
              aksResourceGroup: $(AKS_RESOURCE_GROUP)
              containerRegistryName: $(CONTAINER_REGISTRY_NAME)
              imageRepositoryName: $(IMAGE_REPOSITORY_NAME)
              chartRepositoryName: $(CHART_REPOSITORY_NAME)
              k8sNamespace: $(K8S_NAMESPACE)
              helmReleaseName: $(HELM_RELEASE_NAME)
              chartName: $(CHART_NAME)
              env: $(ENV)
              replicas: $(REPLICAS)
              resourceLimitsCpu: $(RESOURCE_LIMITS_CPU)
              resourceLimitsMemory: $(RESOURCE_LIMITS_MEMORY)
              resourceRequestsCpu: $(RESOURCE_REQUESTS_CPU)
              resourceRequestsMemory: $(RESOURCE_REQUESTS_MEMORY)
              wepayBaseUrl: $(WEPAY_BASE_URL)
              wepayApiVersion: $(WEPAY_API_VERSION)
              wepayAppId: $(WEPAY_APP_ID)
              wepayAppToken: $(WEPAY_APP_TOKEN)
              wepayUploadBaseUrl: $(WEPAY_UPLOAD_BASE_URL)

## EZPAY MERCHANT PORTAL ##
- stage: TST_Merchant_Portal_Deploy
  displayName: TST Merchant Portal Deploy
  dependsOn: []

  jobs:
    - template: /azp-yaml/templates/deploy.yaml@ezpay-frontend-apps
      parameters:
        variableGroup: ezpay-merchant-tst
        targetEnvironment: ezpay-tenant-portal-tst
        dropArtifactPath: $(Pipeline.Workspace)/ezpay-merchant-portal-master-build/drop/tst.zip
        azureServiceConnection: AzDevOps-Pipeline-Principal-DEV-TST-STG

- stage: STG_Merchant_Portal_Deploy
  displayName: STG Merchant Portal Deploy
  dependsOn: TST_Merchant_Portal_Deploy

  jobs:
    - template: /azp-yaml/templates/deploy.yaml@ezpay-frontend-apps
      parameters:
        variableGroup: ezpay-merchant-stg
        targetEnvironment: ezpay-tenant-portal-stg
        dropArtifactPath: $(Pipeline.Workspace)/ezpay-merchant-portal-master-build/drop/stg.zip
        azureServiceConnection: AzDevOps-Pipeline-Principal-DEV-TST-STG

- stage: PRF_Merchant_Portal_Deploy
  displayName: PRF Merchant Portal Deploy
  dependsOn: TST_Merchant_Portal_Deploy

  jobs:
    - template: /azp-yaml/templates/deploy.yaml@ezpay-frontend-apps
      parameters:
        variableGroup: ezpay-merchant-prf
        targetEnvironment: ezpay-tenant-portal-prf
        dropArtifactPath: $(Pipeline.Workspace)/ezpay-merchant-portal-master-build/drop/prf.zip
        azureServiceConnection: AzDevOps-Pipeline-Principal-DEV-TST-STG

- stage: PRD_Merchant_Portal_Deploy
  displayName: PRD Merchant Portal Deploy
  dependsOn: STG_Merchant_Portal_Deploy

  jobs:
    - template: /azp-yaml/templates/deploy.yaml@ezpay-frontend-apps
      parameters:
        variableGroup: ezpay-merchant-prd
        targetEnvironment: ezpay-tenant-portal-prd
        dropArtifactPath: $(Pipeline.Workspace)/ezpay-merchant-portal-master-build/drop/prd.zip
        azureServiceConnection: AzDevOps-Pipeline-Principal-PRD       

## EZPAY PAYER PORTAL ##
- stage: TST_Payer_Portal_Deploy
  displayName: TST Payer Portal Deploy
  dependsOn: []

  jobs:
    - template: /azp-yaml/templates/deploy.yaml@ezpay-frontend-apps
      parameters:
        variableGroup: ezpay-payer-tst
        targetEnvironment: ezpay-payer-portal-tst
        dropArtifactPath: $(Pipeline.Workspace)/ezpay-payer-portal-master-build/drop/tst.zip
        azureServiceConnection: AzDevOps-Pipeline-Principal-DEV-TST-STG

- stage: STG_Payer_Portal_Deploy
  displayName: STG Payer Portal Deploy
  dependsOn: TST_Payer_Portal_Deploy

  jobs:
    - template: /azp-yaml/templates/deploy.yaml@ezpay-frontend-apps
      parameters:
        variableGroup: ezpay-payer-stg
        targetEnvironment: ezpay-payer-portal-stg
        dropArtifactPath: $(Pipeline.Workspace)/ezpay-payer-portal-master-build/drop/stg.zip
        azureServiceConnection: AzDevOps-Pipeline-Principal-DEV-TST-STG

- stage: PRF_Payer_Portal_Deploy
  displayName: PRF Payer Portal Deploy
  dependsOn: TST_Payer_Portal_Deploy

  jobs:
    - template: /azp-yaml/templates/deploy.yaml@ezpay-frontend-apps
      parameters:
        variableGroup: ezpay-payer-prf
        targetEnvironment: ezpay-payer-portal-prf
        dropArtifactPath: $(Pipeline.Workspace)/ezpay-payer-portal-master-build/drop/prf.zip
        azureServiceConnection: AzDevOps-Pipeline-Principal-DEV-TST-STG

- stage: PRD_Payer_Portal_Deploy
  displayName: PRD Payer Portal Deploy
  dependsOn: STG_Payer_Portal_Deploy

  jobs:
    - template: /azp-yaml/templates/deploy.yaml@ezpay-frontend-apps
      parameters:
        variableGroup: ezpay-payer-prd
        targetEnvironment: ezpay-payer-portal-prd
        dropArtifactPath: $(Pipeline.Workspace)/ezpay-payer-portal-master-build/drop/prd.zip
        azureServiceConnection: AzDevOps-Pipeline-Principal-PRD

## Static Assets ##
- stage: TST_Static_Assets_Deploy
  displayName: TST Static Assets Deploy
  dependsOn: []

  jobs:
  - template: static-assets/azp-yaml/templates/ezpay-static-assets-deployment-job.yaml@ezpay-backend-services
    parameters:
      environment: ezpay-static-assets-tst
      serviceConnection: AzDevOps-Pipeline-Principal-DEV-TST-STG
      storageAccount: stezpaytenantfilestst001

- stage: STG_Static_Assets_Deploy
  displayName: STG Static Assets Deploy
  dependsOn: TST_Static_Assets_Deploy

  jobs:
  - template: static-assets/azp-yaml/templates/ezpay-static-assets-deployment-job.yaml@ezpay-backend-services
    parameters:
      environment: ezpay-static-assets-stg
      serviceConnection: AzDevOps-Pipeline-Principal-DEV-TST-STG
      storageAccount: stezpaytenantfilesstg001

- stage: PRD_Static_Assets_Deploy
  displayName: PRD Static Assets Deploy
  dependsOn: STG_Static_Assets_Deploy

  jobs:
  - template: static-assets/azp-yaml/templates/ezpay-static-assets-deployment-job.yaml@ezpay-backend-services
    parameters:
      environment: ezpay-static-assets-prd
      serviceConnection: AzDevOps-Pipeline-Principal-PRD
      storageAccount: stezpaytenantfilesprd001
