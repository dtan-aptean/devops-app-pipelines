parameters:
  serviceName: ''
  svcPrincipalSecret: ''
  acrSecretShr: ''
  acrSecretPrd: ''

steps:
  - pwsh: |
      az login --service-principal -u $(SERVICE_PRINCIPAL_CLIENT_ID_SHR) -p $(SERVICE_PRINCIPAL_SECRET_SHR) --tenant $(TENANT_ID)
      $fullRegistryName = "$(ACR_FULL_NAME_SHR)"
      $latestTag = '20211.103.1-mid.jan.2021'
      az logout
      $env:ACR_SECRET_SHR | docker login $(ACR_FULL_NAME_SHR) --username $(ACR_USER_NAME_SHR) --password-stdin
      docker pull $(ACR_FULL_NAME_SHR)/${{ parameters.serviceName }}:$latestTag
      docker tag $(ACR_FULL_NAME_SHR)/${{ parameters.serviceName }}:$latestTag $(ACR_FULL_NAME_PRD)/${{ parameters.serviceName }}:$latestTag
      docker logout
      $env:ACR_SECRET_PRD | docker login $(ACR_FULL_NAME_PRD) --username $(ACR_USER_NAME_PRD) --password-stdin
      docker push $(ACR_FULL_NAME_PRD)/${{ parameters.serviceName }}:$latestTag      
    displayName: Copy Docker Image for ${{ parameters.serviceName }} Service
    env:
      SP_SECRET: ${{ parameters.svcPrincipalSecret }}
      ACR_SECRET_SHR: ${{ parameters.acrSecretShr }}
      ACR_SECRET_PRD: ${{ parameters.acrSecretPrd }}